# 概述
定义：从用户开始访问网站，到页面完整展示的过程中。使用策略与方法，使页面加载更快、用户操作的响应更及时
## 特点
1. 是一个*循序渐进*的过程，不能像 bug 一样一次解决
2. 需要*持续跟进*，优化
3. 可使用*第三方统计服务*，如阿里云 ARMS、百度统计
## 原则
1. 空间换时间。适用于所有编程的性能优化
	1. 多使用内存、缓存。减少计算、网络请求
2. 减少 CPU 计算量，减少网络加载耗时
3. 要有分析、量化统计、评分。要有具体结果
4. 要包括体验，如骨架屏、loading 动画
5. 不同的形式有不同的方案，多和对方沟通

> [!note] 思路
> [[静态资源]]，页面渲染，服务端与网络，开发流程，质量监控。
> 资源，页面，网络，开发，监控。【页面铺满了紫色的一元，王璐开始发钱，整个过程都经过头上的监控】

# 衡量
## 指标
1. first paint(FP)：资源加载结束，**开始渲染**。不一定可见
	1. 如果*加载慢*，则 FP 开始之前会很长
2. first contentful paint(FCP)：页面**第一次出现内容**（文字，图片）
	1. 如果加载快，但*渲染慢*：FCP 与 LCP 之间可能很长
	2. DCL 与 L 两个指标跟页面上内容呈现没有必须联系（不是面向用户的指标）
3. DOMContentLoaded（DCL）:页面*内容加载*完成 
4. load(L)：所有*资源加载*完毕
5. largest contentful paint(LCP):占视口面积最大的元素，从页面开始加载到页面视口上最大的图片或者文本块渲染的时间
	1. FP 与 FCP 并不考虑
	2. 占视口面积最大的元素何时开始渲染。
		1. 页面在加载过程中，是线性的，元素是一个一个渲染到屏幕上的，而不是一瞬间全渲染到屏幕上。所以渲染面积最大的元素也在一直变化。
6. ~~first meaningful paint(FMP)~~：第一次有意义的内容。大概的内容（如文字、标题）已经显示【已弃用，改用LCP】无法通过技术手段定义
## 工具
### [[Chrome Devtools]] 
performance
可查看上述指标，并提供网页快照
### [[lighthouse]] 
# [[静态资源]] 
2. 减少访问次数
	1. 合并代码
	2. [[SSR]][^1] 
## 资源文件 
图片：需要，选择，压缩，优化，响应式，加载【随着内心的需要上路，分叉的路口站着亚索，手里有花，家在，放屁很响应是有屎】
1. *是否*需要
	1. 小图片使用 data [[URL]] 代替
	2. 使用web Font代替图片
2. 不同场景，*选择*不同格式的图片
	1. JPEG [[JPEG.png]] 
	2. PNG [[PNG.png]] 
	3. GIF [[GIF.png]]  
	4. Webp [[webp.png]] 
3. 如何*压缩*
	1. PNG [[Pasted image 20230714155546.png]] 
	2. JPEG [[Pasted image 20230714155655.png]] 
	3. GIF [[Pasted image 20230714155740.png]] 
4. 图片服务器自动*优化*解密 [[Pasted image 20230714161927.png]] 
	1. 在图片的URL上增加参数，服务器自动生成不同格式、大小、质量的图片
5. *响应式*图片。让图片尺寸随网络环境变化[^3] 
	1. 实现方式
		1. JS绑定事件检测窗口大小
		2. 使用CSS媒体查询 [[Pasted image 20230714160226.png]] 
		3. img标签，H5的srcset属性 [[Pasted image 20230714160245.png]] 。如果设置的像素比是3倍，可选960的图片
6. 逐步*加载*图像 [[Pasted image 20230714160417.png]] 
## [[HTML]] 
1. 精简代码
	1. 减少HTML嵌套
	2. 减少DOM节点数
	3. 减少无语义代码。如（使用CSS代替\<div> class="clear">\</div>清除浮动）
	4. 删除HTTP或HTTPS。如果资源的协议与当前页面的协议一致。
	5. 删除多余的空格、换行符、缩进、不必要的注释
	6. 省略冗余的标签、属性
	7. 如果资源是同域，可仅使用相对路径的URL
2. 标签位置
	1. CSS样式文件链接放在页面头部
		1. 加载不会阻塞DOM tree解析，但会阻塞它渲染、后续JS执行。
		2. 减少浏览器重排文档的次数
	2. JS放在HTML底部
		1. 防止JS的加载、解析、执行阻塞页面后续元素的渲染。
3. 用户体验
	1. 设置favicon.ico
		1. 不设置，控制台会报错
		2. 页面加载时没有输入图标loading过程，不利于网站品牌。
	2. 增加首屏必要的CSS与JS
		1. 一些SPA，首屏内容很少，HTML没有内容。在弱网情况下可能是空白。
			1. 增加loading效果或骨架屏
## [[CSS]] 
1. 提升渲染性能
	1. 谨慎使用expensive属性
		1. nth-child伪类；固定定位
	2. 减少样式层级数
		1. div ul li span li {color: blue;}
	3. 避免使用占用过多CPU和内存的属性
		1. 如text-indent: -99999 px; 这个值很大，而且这个属性本身就占用更多的CPU和内存
	4. 避免使用耗电量大的属性，占GPU
		1. CSS3 3D的transforms、 CSS3 transitions、opacity
2. 选择器
	1. 避免使用CSS表达式 [[Pasted image 20230714171309.png]] 
	2. 避免使用通配选择器  body > a {font-weight:blod;}
	3. 避免类正则的属性选择器：\*=, |=, ^=, $=
3. 提升CSS加载性能
	1. 使用外链CSS
	2. 避免使用@import
4. 精简
	1. 使用总写，不要分写
	2. 删除不必要的0、分号、空格、注释
	3. 不必要的单位：0 px时不用带单位
5. 合理使用web fonts
	1. 将字体部署在CDN上，加快用户下载字体文件的速度
	2. 字体：以base 64形式保存在CSS中，并通过localStorage缓存
	3. Google字体库，应使用国内托管服务
6. CSS动画优化
	1. 减少同屏动画。视口中不要同时出现过多动画
	2. 动画延时1秒再渲染，保证其他CSS先渲染
	3. 结合 [[SVG]]。它是矢量的，把需要的动画放在SVG中展示
	4. 使用 [[requestAnimationFrame]] 代替定时器？
## [[JS]] 
原则
	1. 需要时才优化
	2. 考虑可维护性
1. 变量与函数
	1. 尽量使用ID选择器（速度最快）
	2. 避免使用eval（耗费性能）
	3. 函数尽可能简洁
	4. 使用节流、防抖
	5. 使用事件委托
2. 动画优化
	1. 避免大量JS动画，尽量CSS 3动画、canvas动画
	2. 合理使用 [[requestAnimationFrame]] 动画代替定时器
3. 合理缓存
	1. 合理缓存DOM查询
	2. 缓存列表长度。业务逻辑、查询DOM子节点
	3. 使用可缓存的 [[AJAX]] ，[[HTTP缓存]] 
		1. [[cookie]] 
		2. [[sessionStorage]] 从页面A跳转到页面B
		3. [[indexDB]] 
		4. [[localStorage]] 如何把静态资源文件缓存到这个里面？
4. [[JS模块化]]  
	1. 如何选择方案？
	2. 减少回流和重绘：[[浏览器原理]] 
## 源码
## 框架
### [[React性能优化]] 
### [[vue性能优化]] 
# 页面渲染架构设计及方案选型
接口服务调优、缓存策略
页面加载策略
前端[[组件化]] 、[[模块化]]以加速业务开发 
[[前后端分离]]、[[SPA]] 
[[PWA]] 
# 原生APP优化方案
浏览器的整体优化方案
	导航条、滚动条
webView的缓存策略与优化
H5静态资源请求代理
H5离线化技术
混合式开发解决方案
# 服务端与网络
减少HTTP请求数
升级HTTP 2.0
开启HTTPS
[[CDN]] 与DNS优化
gzip压缩
减小cookie大小
[[Nginx]] 缓存配置与优化
# 开发流程
掉盐，自动用口接
	1. 技术调研的方法
	2. 前后端接口约定、联调
	3. 自动化测试、部署
# 全链路质量监控体系建设
目的：对性能优化的结果进行衡量、评估
上线前：H5质量及时检测
上线后：H5*性能与错误*监控、*线上页面可用性*监控、原生APP的*性能与错误*监控

# 构建

# 渲染
1. [[CSS]]放在head，[[JS]]放在body底部
2. 尽量开始执行JS，用DOMContentLoaded触发
3. [[SSR]] 
4. [[懒加载]] 
5. DOM操作[^2] 
	1. 缓存DOM查询![[Pasted image 20230704124330.png]]
	2. 频繁DOM操作，合并到一起再插入![[Pasted image 20230704124525.png]]

# 体验
[[工具函数]] 

[^1]: 将资源一次性显示
[^2]: JS计算的速度比DOM查询的速度快很多。
[^3]: 通过在图片URL后添加不同参数，在不同网络环境（WIFI/5G/4G/3G）下，加载不同尺寸和像素的图片