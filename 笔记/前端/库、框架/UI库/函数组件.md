# æ¦‚è¿°
æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œï¼ˆreactåªéœ€ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œå®ƒï¼‰ï¼Œæ¥æ”¶å‚æ•°ï¼ˆç»„ä»¶çš„å±æ€§ï¼‰ï¼Œè¿”å›å€¼ï¼ˆè¿”å›çš„å†…å®¹å°†ä½œä¸ºè¯¥ç»„ä»¶çš„UIï¼‰
ç›®çš„ï¼šä¸ºäº†åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨[[çŠ¶æ€]]ä¸[[å‰¯ä½œç”¨]]ï¼ˆå‡½æ•°ç»„ä»¶æ›¾è¢«åŒºåˆ«ç§°ä¸ºâ€œæ— çŠ¶æ€ç»„ä»¶â€ï¼‰ã€‚
æ„ä¹‰
	1. å‘æ˜hooksçš„åŠ¨æœºï¼šåœ¨æ— çŠ¶æ€ç»„ä»¶éœ€è¦çŠ¶æ€æ—¶ï¼Œä¸éœ€è¦å®Œå…¨é‡æ„ä¸ºç±»ï¼Œå¯ç›´æ¥ä½¿ç”¨çŠ¶æ€ç®¡ç†ã€å‰¯ä½œç”¨
	2. å®ƒå¦‚ä½•æ”¹å˜äº†react
		1. æ—¢ç„¶ä¸€ä¸ªå‰¯ä½œç”¨æœ‰å®ƒè‡ªå·±çš„è®¾ç½®å’Œæ¸…é™¤é˜¶æ®µï¼Œå°±æŠŠå®ƒæ”¾åœ¨åŒä¸€ä¸ªhookä¸­
		2. contextçš„æŠ½è±¡ä¹Ÿå¥½ï¼ŒHOCä¸render propsçš„æŠ½è±¡ä¹Ÿå¥½ï¼Œéƒ½å¢åŠ äº†ç»„ä»¶çš„*åµŒå¥—åœ°ç‹±*ã€‚
			1. å½¢æˆäº†å¯è¯»æ€§å¾ˆå·®çš„ç»„ä»¶æ ‘ï¼Œå› ä¸ºæ‰€æœ‰çš„æŠ½è±¡é€»è¾‘éƒ½ç”¨ç»„ä»¶å®ç°ï¼Œå®é™…ç”¨äºå±•ç¤ºçš„ç»„ä»¶å´å¾ˆéš¾è¿½è¸ª
			2. å°†è¿™äº›å¹¶éç”¨äºå±•ç¤ºçš„ç»„ä»¶ï¼ˆé€»è¾‘ç»„ä»¶ï¼‰ä½¿ç”¨å‰¯ä½œç”¨å°è£…ã€‚å°±æ‰“å¹³äº†ç»„ä»¶æ ‘çš„ç»“æ„
å‰æ
	1. å¦‚æœä¸ç†è§£[[Function]]ã€[[çº¯å‡½æ•°]]ã€[[éçº¯å‡½æ•°]]ã€[[å‰¯ä½œç”¨]]ï¼Œå°±æ— æ³•ç†è§£reactå¤„ç†å‡½æ•°ç»„ä»¶çš„æ–¹å¼ã€‚
		1. æˆ‘ä»¬åˆ›å»ºçš„ç»„ä»¶å¯èƒ½æ˜¯çº¯å‡½æ•°ï¼Œä¹Ÿä¼šæ˜¯éçº¯å‡½æ•°ã€‚å…³é”®åœ¨äºè¦çŸ¥é“è‡ªå·±æ­£åœ¨åˆ›å»ºä»€ä¹ˆå‰¯ä½œç”¨ã€‚
## ä½¿ç”¨æ¡ä»¶
åœ¨**å‡½æ•°ç»„ä»¶å†…**çš„**æœ€é¡¶å±‚**[[ä½œç”¨åŸŸ]]ã€‚
	1. é¡¶å±‚èƒ½ä¿è¯Hookæ¯æ¬¡æ¸²æŸ“éƒ½æŒ‰é¡ºåºè¢«è°ƒç”¨ã€‚åœ¨æ¡ä»¶è¯­å¥ä¸­ä¼šå¯¼è‡´é¡ºåºæ”¹å˜ï¼Œreactæ— æ³•æ­£ç¡®å…³è”å†…éƒ¨stateä¸å¯¹åº”çš„hook
# åŸç†
## å®šä¹‰
æ¥æ”¶ä¸¤ä¸ªå±æ€§ï¼šprops, ref
1. propsï¼šã€å‘å†…ä¼ é€’ã€‘
2. ref
	1. èšç„¦æ–‡å­—è¾“å…¥æ¡†
	2. æ»šåŠ¨å›¾ç‰‡åˆ°è§†å›¾
	3. æ’­æ”¾å’Œæš‚åœè§†é¢‘ 
	4. çˆ¶ç»„ä»¶çº§åˆ«å¾—åˆ°*è‡ªå®šä¹‰ç»„ä»¶*[^3]å†…çš„DOMå…ƒç´ 
		1. å°†è¯¥å‚æ•°ä½œä¸ºæŸä¸ªç»„ä»¶çš„refå±æ€§å€¼
		2. ä½¿ç”¨react.forwardRefå‡½æ•°åŒ…è£¹ï¼Œå°†å…¶æš´éœ²ç»™çˆ¶ç»„ä»¶
## æ‰§è¡Œ
1. æŒ‚è½½ã€ç»„ä»¶æŒ‚è½½åˆ°DOMç»“æ„ä¸­ã€‘
	1. æ‰§è¡Œéæ¸²æŸ“ä»£ç 
		1. useStateï¼š*åˆå§‹å€¼*ä½œä¸ºæœ€æ–°å¸¸é‡è¿”å›ï¼Œç”Ÿæˆ*åªå±äºæ­¤æ¬¡æ¸²æŸ“*çš„ï¼ˆstate+props+eventHandlerï¼‰
		2. useEffect
			1. æ•è·æ‰€æœ‰ä¾èµ–å˜é‡
			2. æ·»åŠ éœ€è¦è¢«æ‰§è¡Œå’Œæ¸…é™¤çš„å‰¯ä½œç”¨[^1] 
	2. æ‰§è¡Œæ¸²æŸ“ä»£ç 
		1. æ‰§è¡Œreturnï¼Œè¯»å–æ­¤æ¬¡æ‰§è¡Œæ—¶ä½¿ç”¨props, state, eventHandleræ‰€ç”Ÿæˆçš„**å¿«ç…§**ï¼Œå¹¶ä¾æ®è¯¥å¿«ç…§ç”ŸæˆUIçš„å¿«ç…§ã€‚
	3. æ¸²æŸ“å®Œæ¯•
	4. æ‰§è¡ŒuseEffectä¸­æ·»åŠ çš„[[å‰¯ä½œç”¨]] 
		1. useEffectä½¿ç”¨å…¨æ–°çš„propsï¼Œstateç»‘å®šå‰¯ä½œç”¨
2. æ›´æ–°ã€ç»„ä»¶æ›´æ–°ã€‘
	1. æ‰§è¡Œéæ¸²æŸ“ä»£ç 
		1. useStateï¼š*setStateä¼ å…¥å€¼*ä½œä¸ºæœ€æ–°å¸¸é‡è¿”å›ï¼Œç”Ÿæˆ*åªå±äºæ­¤æ¬¡æ¸²æŸ“*çš„ï¼ˆstate+props+eventHandlerï¼‰
		2. useEffectã€å¦‚æœ**ä¾èµ–æ²¡æœ‰æ›´æ–°**ï¼Œåˆ™**ä¸æ‰§è¡Œ**ã€‘
	2. æ‰§è¡Œæ¸²æŸ“ä»£ç 
	3. æ¸²æŸ“å®Œæ¯•
	4. æ£€æŸ¥é˜Ÿåˆ—
		1. å¦‚æœæœ‰
			1. æ‰§è¡Œæ¸²æŸ“å‰æ·»åŠ çš„æ¸…é™¤å‰¯ä½œç”¨ã€å› ä¸ºå¤§å¤šæ•°effectçš„æ‰§è¡Œå¹¶ä¸ä¼šé˜»å¡DOMæ›´æ–°ï¼Œæ‰€ä»¥å…ˆæ¸…é™¤ã€‘
			2. æ‰§è¡Œæ¸²æŸ“å‰æ·»åŠ çš„å‰¯ä½œç”¨ã€å¦‚æœè¢«è·³è¿‡ï¼Œåˆ™ä¸æ‰§è¡Œã€‘
3. å¸è½½
	1. æ¸…é™¤å‰¯ä½œç”¨

æ¯æ¬¡stateæ›´æ–°ï¼Œéƒ½ä¼šé‡æ–°ç”Ÿæˆç»„ä»¶UIã€é€»è¾‘çš„å¿«ç…§ã€‚
æ ¹æ®æŸä¸ªstateæ›´æ–°ï¼Œå†³å®šæ˜¯å¦æ›´æ–°å‰¯ä½œç”¨ã€‚
# useState
æœ¬è´¨ï¼šå°†æœ¬åœ°çš„[[çŠ¶æ€]]å°è£…åœ¨å‡½æ•°[[ç»„ä»¶]]ä¸­ã€‚
å½¢å¼ï¼šconst [state, setState] = useState(initialValue)
	1. stateï¼šä¿å­˜*çŠ¶æ€*çš„å˜é‡
		1. æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šè°ƒç”¨ã€‚æŒ‚è½½æ—¶è¿”å›InitialValueï¼Œæ›´æ–°æ—¶è¿”å›æœ€æ–°setçš„å€¼
	2. setStateï¼šä¿å­˜*ä¿®æ”¹çŠ¶æ€çš„å‡½æ•°*çš„å˜é‡
		1. [[Function]]ï¼šå»è·å–å½“å‰ç»„ä»¶ä¸­ç»´æŠ¤çš„æœ€æ–°çš„çŠ¶æ€å€¼ï¼ˆå¹¶ä¸æ˜¯æ­¤æ¬¡æ¸²æŸ“çš„å€¼ï¼‰
			1. setCount(count => count + 1)
			2. **è¯»å–reactä¸­ç»´æŠ¤çš„å€¼ï¼Œè€Œä¸æ˜¯æ­¤æ¬¡æ¸²æŸ“ä¸­çš„å€¼**ã€‚å³ä½¿å½“å‰æ¸²æŸ“çš„stateå¹¶æ²¡æœ‰æ›´æ–°ï¼Œæ˜¯åœ¨å®šæ—¶å™¨ä¸­ä¿®æ”¹çš„ï¼Œä¹Ÿå¯è¯»å–ã€‚
			3. **stateçš„æ›´æ–°ä¾èµ–äºæ—§å€¼**ã€æ­¤æ—¶[[å‡½æ•°ç»„ä»¶#useReducer|userReducer]]å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‘
		2. [[å€¼]]ï¼šå½“å‰è¯»å–åˆ°çš„ï¼ˆå¯èƒ½æ˜¯æ—§å€¼ï¼‰
	3. initialValueï¼šçŠ¶æ€çš„åˆå§‹å€¼
		1. [[Function]]ï¼šåˆå§‹åŒ–æ—¶è°ƒç”¨ï¼Œè®¾ç½®è¿”å›å€¼ä¸ºåˆå§‹å€¼
		2. [[å€¼]] 
æ‰§è¡Œæœºåˆ¶
	1. æ¯æ¬¡æ¸²æŸ“æ—¶ï¼Œå°†åˆå§‹å€¼ï¼ˆæŒ‚è½½ï¼‰æˆ–é€šè¿‡setStateä¼ å…¥çš„å€¼ï¼ˆæ›´æ–°ï¼‰å£°æ˜ä¸ºå½“å‰ç»„ä»¶å†…çš„**å¸¸é‡**ã€‚
## åŸç†
1. ä»reactä¸­å¯¼å…¥ï¼Œä½†ä¸æ˜¯åœ¨è¿™ä¸ªåŒ…ä¸­å®ç°çš„ï¼Œè€Œæ˜¯åœ¨react-reconcilerã€‚
	1. åœ¨try/catchä¸­ï¼Œä½¿ç”¨äº†mountStateï¼ˆinitialValueï¼‰æ–¹æ³•
	2. å…³é”®æ˜¯mountStateçš„å®ç° ![[Pasted image 20230601130853.png]] 
2. å¤šä¸ªè°ƒç”¨ï¼Œå¦‚ä½•ä¿è¯æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ
	1. åˆå§‹åŒ–æ—¶
		1. æ¯æ¬¡è°ƒç”¨ï¼šéƒ½ä¼šè¿”å›ä¸€ä¸ªhookå¯¹è±¡ã€ç”Ÿæˆä¸€å¯¹state/setteræ˜ å°„ã€‚
		2. æ¯æ¬¡æ¸²æŸ“ï¼šéƒ½ä¼šæŒ‰ç…§*åˆå§‹åŒ–çš„åºåˆ—*éå†*ç”±å¤šä¸ªæ˜ å°„ç»„æˆçš„æ•°ç»„*ã€‚
	2. åˆå§‹åŒ–stateæ—¶ï¼Œä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ä¸­ï¼Œå› ä¸ºæ¯æ¬¡æ‰§è¡Œéƒ½æ˜¯æŒ‰ç…§åˆå§‹åŒ–çš„é¡ºåºæ‰§è¡Œã€‚å­˜åœ¨æ¡ä»¶è¯­å¥åˆ™æ•°ç»„é¡ºåºå¯èƒ½ä¸åŒã€‚
# useEffect

> [!åŠŸèƒ½] 

æ‰§è¡Œç›®çš„
	1. ç»„ä»¶æŒ‚è½½/ä¾èµ–æ›´æ–°/æ²¡æœ‰ä¾èµ–æ—¶ï¼Œå¯¹ç»„ä»¶å†…çŠ¶æ€è¿›è¡Œ**æ•è·å¹¶æ’é˜Ÿ**ã€‚ç»„ä»¶==æ¸²æŸ“å==ï¼Œå…ˆ**æ‰§è¡Œ**ä¸Šæ¬¡æ¸²æŸ“æ•è·çš„æ¸…é™¤é€»è¾‘ï¼Œå†æ‰§è¡Œæ­¤æ¬¡æ¸²æŸ“æ•è·çš„æ·»åŠ é€»è¾‘ã€‚
	2. ç»„ä»¶å¸è½½æ—¶ï¼Œæ‰§è¡Œä¸Šæ¬¡æ¸²æŸ“æ•è·çš„æ¸…é™¤é€»è¾‘
å†…éƒ¨æœºåˆ¶
	1. æ²¡æœ‰ä¾èµ–ï¼šæ¯æ¬¡æ¸²æŸ“æ—¶
	2. ç©ºæ•°ç»„
		1. æŒ‚è½½æ—¶ï¼šä¿å­˜æ·»åŠ ä¸æ¸…é™¤é€»è¾‘ã€‚æ¸²æŸ“å®Œæˆåæ‰§è¡Œæ·»åŠ é€»è¾‘ï¼Œå¸è½½æ—¶æ‰§è¡Œæ¸…é™¤é€»è¾‘
		2. æ›´æ–°æ—¶ï¼šä¸æ‰§è¡Œ
		3. å¸è½½æ—¶ï¼šæ‰§è¡Œæ¸…é™¤é€»è¾‘
	3. å­˜åœ¨ä¾èµ–
		1. æŒ‚è½½æ—¶ï¼šä¿å­˜æ·»åŠ ä¸æ¸…é™¤é€»è¾‘ã€‚æ¸²æŸ“å®Œæˆåæ‰§è¡Œæ·»åŠ é€»è¾‘ï¼Œå¸è½½æ—¶æ‰§è¡Œæ¸…é™¤é€»è¾‘
		2. ä¾èµ–æœªæ›´æ–°ï¼šä¸æ‰§è¡Œ
		3. ä¾èµ–æ›´æ–°
			1. æ‰€æœ‰çŠ¶æ€å’ŒDOMæ›´æ–°åï¼Œä¸Šæ¬¡æ¸²æŸ“æ—¶å®šä¹‰çš„æ¸…é™¤é€»è¾‘ã€‚
			2. æ˜¯æ­¤æ¬¡æ¸²æŸ“æ—¶æ•è·çš„æ·»åŠ é€»è¾‘
æ‰§è¡Œæœºåˆ¶ï¼šæ•è·å˜é‡ï¼Œå‰¯ä½œç”¨çš„æ·»åŠ é€»è¾‘åœ¨*æ­¤æ¬¡æ¸²æŸ“å*æ‰§è¡Œï¼Œå‰¯ä½œç”¨çš„æ¸…é™¤é€»è¾‘åœ¨
	1. ä¾èµ–æ›´æ–°ï¼š*ä¸‹æ¬¡æ¸²æŸ“åã€å‰¯ä½œç”¨æ·»åŠ é€»è¾‘æ‰§è¡Œå‰*æ‰§è¡Œ
	2. ç»„ä»¶å¸è½½ï¼šç»„ä»¶å¸è½½å‰æ‰§è¡Œ
> [!note] åŸç†
> 

1. **æ•è·**å®šä¹‰å®ƒçš„é‚£æ¬¡æ¸²æŸ“ä¸­çš„propsä¸state
	1. ã€åœ¨å‰¯ä½œç”¨è®¾ç½®å‡½æ•°é‡Œï¼Œæ‹¿åˆ°çš„æ˜¯åˆå§‹çš„propsä¸stateã€‚å¦‚æœæƒ³æ‹¿åˆ°æœ€æ–°å€¼ã€‘
		1. æ·»åŠ åˆ°ä¾èµ–é˜Ÿåˆ—ã€ä»…å½“å‰¯ä½œç”¨éœ€è¦ä¾èµ–è¯¥stateæ—¶ã€‘
		2. ä½¿ç”¨useRefã€‚ä»å¤–ç•Œè·å–æœ€æ–°state
		3. åœ¨å‰¯ä½œç”¨çš„setStateä¸­ä¼ å…¥å‡½æ•°ã€‚
	2. æ¸…é™¤å‰¯ä½œç”¨æ—¶ä¿å­˜çš„å€¼ä¼šåœ¨ä¸‹æ¬¡æ¸²æŸ“æ—¶è¢«è°ƒç”¨ã€‚
		1. æ­¤æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œçš„æ¸…é™¤é€»è¾‘ä¸­ï¼Œä¿å­˜çš„éƒ½æ˜¯ä¸Šæ¬¡æ¸²æŸ“çš„çŠ¶æ€
	3. ç›‘å¬å€¼æ²¡æœ‰æ”¹å˜ï¼Œæ‰€ä»¥è¯¥æ¬¡æ›´æ–°æ²¡æœ‰æ‰§è¡Œè¯¥effect
å½¢å¼ï¼šuseEffect(() => {}, [])
	1. []ï¼šè¯¥å‰¯ä½œç”¨ä¸ä½¿ç”¨[[react]]*æ•°æ®æµä¸­çš„å€¼*ã€‚åªåœ¨ç»„ä»¶*æŒ‚è½½æ—¶*è°ƒç”¨ä¸€æ¬¡ã€‚
	2. [a]ï¼šç»„ä»¶*æŒ‚è½½æ—¶ã€aæ”¹å˜*æ—¶ã€ä»…åœ¨æŸäº›çŠ¶æ€æ”¹å˜æ—¶æ‰§è¡Œçš„å‰¯ä½œç”¨ã€‘
	3. useEffect(()=>{})ï¼šæ¯æ¬¡çŠ¶æ€æ”¹å˜æ—¶ã€æ²¡æœ‰æ„ä¹‰ï¼Œè·Ÿç›´æ¥å†™åœ¨å¤–é¢ç›¸åŒã€‘
ç‰¹æ€§
	1. å¦‚æœä¾èµ–åˆ—è¡¨ä¸­æ²¡æœ‰ç›‘å¬æŸä¸ªstateï¼Œåˆ™ä¸ä¼šé‡æ–°æ•è·ï¼Œå¯¼è‡´æ¯æ¬¡è°ƒç”¨å‰¯ä½œç”¨æ—¶ä½¿ç”¨çš„éƒ½æ˜¯æ—§stateã€‚
		1. `setCount(count => count + 1)`ã€‚å­˜åœ¨é—®é¢˜ï¼šå¦‚æœæœ‰ä¸¤ä¸ªäº’ç›¸ä¾èµ–çš„çŠ¶æ€ï¼Œåˆ™ä¸èƒ½åšåˆ°ã€‚
		2. ä¸è¯¥æ–¹æ³•ç›¸ä¼¼çš„æ˜¯[[#useReducer]]å¯åšåˆ°
> [!note] å¸¸è§é—®é¢˜
> 

1. ä½ ä»¥ä¸ºæ²¡æœ‰ä½¿ç”¨æ•°æ®æµä¸­çš„å€¼ï¼Œä½†å…¶å®ä½¿ç”¨äº†ã€‚ä½ è¦ä½¿ç”¨ç­–ç•¥ï¼ˆä¸»è¦æ˜¯useReducer å’Œ useCallbackï¼‰æ¥ç§»é™¤è¿™äº›effectä¾èµ–ã€‚
> [!note] åº”ç”¨
> 

## ä»…å½“ç»„ä»¶æ›´æ–°æ—¶æ‰§è¡Œå‰¯ä½œç”¨
```js
const Toggler = ({ toggle, onToggle }) => {
// æ·»åŠ â€œå·²æŒ‚è½½â€çš„æ ‡è¯†
  const didMount = React.useRef(false);
// åœ¨ä»»æ„ä¸€ä¸ªå‰¯ä½œç”¨ä¸­è¯»å–refå€¼ï¼Œå¦‚æœæ˜¯falseå°±å–åï¼Œå¦‚æœæ˜¯trueå°±æ‰§è¡Œå‰¯ä½œç”¨
  React.useEffect(() => {
    if (didMount.current) {
      console.log('I run only if toggle changes.');
    } else {
      didMount.current = true;
    }
  }, [toggle]);

  return (
    <div>
      <button type="button" onClick={onToggle}>
        Toggle
      </button>

      {toggle && <div>Hello React</div>}
    </div>
  );
};
```
## ä»…å½“ä¾èµ–æ”¹å˜æ—¶æ‰§è¡Œä¸€æ¬¡å‰¯ä½œç”¨
```js
const Toggler = ({ toggle, onToggle }) => {
  // æ·»åŠ å·²â€œæ‰§è¡Œä¸€æ¬¡â€çš„æ ‡è¯†
  const calledOnce = React.useRef(false);

  React.useEffect(() => {
    if (calledOnce.current) {
      return;
    }

    if (toggle === false) {
      console.log('I run only once if toggle is false.');

      calledOnce.current = true;
    }
  }, [toggle]);

  return (
    <div>
      <button type="button" onClick={onToggle}>
        Toggle
      </button>

      {toggle && <div>Hello React</div>}
    </div>
  );
};
```
> [!note] ç›¸å…³
> 

[useEffect å®Œæ•´æŒ‡å— â€” Overreacted](https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/) 
## æ€»ç»“

# useLayoutEffect
è€Œæˆ‘ä»¬çš„ç»„ä»¶ä» state å˜åŒ–åˆ°æ¸²æŸ“ï¼Œå¤§æ¦‚å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥
	1. æ”¹å˜ stateï¼Œè§¦å‘æ›´æ–° state å˜é‡çš„æ–¹æ³•
	2. React æ ¹æ®ç»„ä»¶è¿”å›çš„ vDOM è¿›è¡Œ diff å¯¹æ¯”ï¼Œå¾—åˆ°æ–°çš„ Virtual DOM
	3. å°†æ–°çš„ VDom äº¤ç»™æ¸²æŸ“çº¿ç¨‹å¤„ç†ï¼Œç»˜åˆ¶åˆ°æµè§ˆå™¨ä¸Š
	4. ç”¨æˆ·çœ‹åˆ°æ–°çš„å†…å®¹
useEffect 
	1. åœ¨ç¬¬ 3 æ­¥ä¹‹åæ‰§è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯åœ¨æµè§ˆå™¨ç»˜åˆ¶ä¹‹åæ‰è°ƒç”¨
	2. å¼‚æ­¥æ‰§è¡Œçš„ï¼Œæ‰€è°“å¼‚æ­¥å°±æ˜¯è¢« requestIdleCallback å°è£…ï¼Œåªåœ¨æµè§ˆå™¨ç©ºé—²æ—¶å€™æ‰ä¼šæ‰§è¡Œï¼Œä¿è¯äº†ä¸ä¼šé˜»å¡æµè§ˆå™¨çš„æ¸²æŸ“è¿‡ç¨‹ã€‚
useLayoutEffect
	1. åœ¨ç¬¬äºŒæ­¥ä¹‹åï¼ˆdiff å‡ºæ–°çš„ vDOM ä¹‹åï¼‰ï¼Œç¬¬ä¸‰æ­¥ä¹‹å‰æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æ¸²æŸ“ä¹‹å‰åŒæ­¥æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¼šç­‰å®ƒæ‰§è¡Œå®Œå†æ¸²æŸ“é¡µé¢åˆ°æµè§ˆå™¨ä¸Šã€‚
ç»“è®ºï¼š
	1. ä¸useEffectçš„åŒºåˆ«
		1. åœ¨æ¸²æŸ“å‰æ‰§è¡Œï¼Œè€Œä¸æ˜¯æ¸²æŸ“å
		2. åŒæ­¥çš„ï¼Œä¼šé˜»å¡DOMæ¸²æŸ“ã€‚
		3. æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆ[[SSR]]ï¼‰æ—¶useLayoutEffect æ— æ•ˆï¼Œä½¿ç”¨ useEffect
	2. å¦‚æœè¦æ“ä½œ DOMï¼Œæˆ–è€…ä¸æƒ³å‡ºç° **å†…å®¹é—ªçƒ** çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°±æ˜¯ç”¨ useLayoutEffect
# useRef
æœ¬è´¨ï¼šä¿å­˜ä¸€ä¸ªä¼šçªå˜çš„refå¯¹è±¡ï¼Œåœ¨ç»„ä»¶çš„æ‰§è¡Œå‘¨æœŸä¸­å§‹ç»ˆå­˜åœ¨ã€‚
ä½œç”¨ï¼šä¿å­˜ä¸€ä¸ªä¸é¡µé¢æ¸²æŸ“æ— å…³çš„æ•°æ®ã€‚ä¸€èˆ¬æ˜¯DOMã€‚
## åº”ç”¨
1. ä½¿å‰¯ä½œç”¨ä»…åœ¨æ›´æ–°æ—¶æ‰§è¡Œ
2. å®šæ—¶å™¨
# useMemo
ä¼ å‚ï¼šåŒ[[å‡½æ•°ç»„ä»¶#useEffect]]ã€‚
åŠŸèƒ½ï¼šå½“ä¾èµ–æ”¹å˜æ—¶ï¼Œé‡æ–°è®¡ç®—å¹¶è¿”å›ä¸€ä¸ªæ–°å€¼
## é¿å…æ— æ„ä¹‰çš„é‡æ–°è®¡ç®—
ä¸€ä¸ªå€¼çš„è®¡ç®—è¿‡ç¨‹è¾ƒå¤æ‚ï¼Œå‚æ•°æ²¡æœ‰æ›´æ–°æ—¶ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®—
	1. totoListå·²å®Œæˆã€æœªå®Œæˆã€å…¨éƒ¨çš„ç­›é€‰
## é¿å…é‡æ¸²æŸ“
1. ç»„ä»¶çš„æ¸²æŸ“å¼€é”€è¾ƒå¤§æ—¶
	1. å®šä¹‰æ—¶ä½¿ç”¨react.memoåŒ…è£¹ç»„ä»¶
	2. è°ƒç”¨æ—¶ä½¿ç”¨useMemoåŒ…è£¹å¼•ç”¨ç±»å‹çš„å±æ€§å€¼[^4] 
åŸå› ï¼šå½“ä¸€ä¸ªç»„ä»¶æ›´æ–°æ—¶ï¼Œå³ä½¿å­ç»„ä»¶æ¥æ”¶çš„propsæ²¡æœ‰æ›´æ–°ä¹Ÿä¼šé‡æ–°æ¸²æŸ“ã€‚
é—®é¢˜ï¼šå¦‚æœä¼ é€’çš„å±æ€§æ˜¯å¼•ç”¨ç±»å‹æ•°æ®ï¼Œä»å†…å®¹ä¸Šçœ‹ç¡®å®æ²¡å˜ï¼Œä½†çˆ¶ç»„ä»¶é‡æ–°æ‰§è¡Œå°±æ˜¯å£°æ˜äº†ä¸€ä¸ª*æ–°å€¼*ï¼Œæ‰€ä»¥å­ç»„ä»¶ä»ä¼šæ›´æ–°
	æ–¹æ¡ˆï¼šå°†ä¼ é€’çš„å¼•ç”¨ç±»å‹æ•°æ®ã€å‡½æ•°æˆ–å…¶ä»–å¼•ç”¨ç±»å‹å€¼ã€‘ä½¿ç”¨useMemoï¼Œä¿ç•™å¼•ç”¨å€¼ã€‚
```js
import React, { memo, useState } from 'react';

// å­ç»„ä»¶
const ChildComp = (props:{info:{name, age}}) => {
  console.log('ChildComp...',name,age);
  return (<div>ChildComp...</div>);

};

const MemoChildComp = memo(ChildComp);

// çˆ¶ç»„ä»¶
const Parent = () => {
  const [count, setCount] = useState(0);
  const [name] = useState('jack');
  const [age] = useState(11);
  // æ›´æ–°å‰ï¼šä¼šä¸€ç›´é‡æ–°æ¸²æŸ“
  const info = { name, age };
  // æ›´æ–°åï¼šå¼•ç”¨ç±»å‹ä¸ä¼šå†å¯¼è‡´é‡æ–°æ¸²æŸ“
  const info = useMemo(() => ({ name, age }), [name, age]);
  return (
    <div className="App">
      <div>hello world {count}</div>
      <button onClick={() => { setCount(count => count + 1); }}>ç‚¹å‡»å¢åŠ </button>
      <MemoChildComp info={info}/>
    </div>
  );
};

export default Parent;

```

## ç¼“å­˜å¦ä¸€ä¸ªhookçš„ä¾èµ–
```js
function Dropdown({ allItems, text }) {
  // ä½œä¸ºä¾èµ–ï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°ç”Ÿæˆï¼Œå¯¼è‡´ä¸‹æ–¹çš„visibleItemsçš„ç¼“å­˜å¤±å»ä½œç”¨
  const searchOptions = { matchMode: 'whole-word', text };
  // ä½œä¸ºä¾èµ–çš„å¯¹è±¡å­—é¢é‡ï¼Œåº”ä½¿ç”¨useMemoåˆ›å»º
  const searchOptions = useMemo(() => {
    return { matchMode: 'whole-word', text };
  }, [text]);
  
  const visibleItems = useMemo(() => {
    return searchItems(allItems, searchOptions);
  }, [allItems, searchOptions]); // ğŸš© Caution: Dependency on an object created in the component body
  // ...
  }
```

# useCallback
ä¼ å‚ï¼šåŒ[[å‡½æ•°ç»„ä»¶#useEffect]]ã€‚
åŠŸèƒ½ï¼šè¿”å›ä¸€ä¸ªå‡½æ•°å®šä¹‰ã€‚å½“ä¾èµ–æ”¹å˜æ—¶ï¼Œè¿”å›ä¸€ä¸ªæ–°å‡½æ•°
	å³ä½¿å¤šæ¬¡æ›´æ–°ï¼Œä¹Ÿèƒ½æ‹¿åˆ°ç›¸åŒçš„å‡½æ•°
```js
import { useCallback } from 'react';

export default function ProductPage({ productId, referrer, theme }) {
  // ç¼“å­˜å‡½æ•°å£°æ˜
  const handleSubmit = useCallback((orderDetails) => {
    post('/product/' + productId + '/buy', {
      referrer,
      orderDetails,
    });
  }, [productId, referrer]);
  return ()
  }
```
## é¿å…é‡æ¸²æŸ“
å½“å­ç»„ä»¶ä½¿ç”¨äº†react.memoä¸”å­˜åœ¨æŸä¸ªå±æ€§ä¸ºå‡½æ•°æ—¶ï¼Œä½¿ç”¨useCallbackï¼ˆå‡å°‘æ¸²æŸ“æ¬¡æ•°ï¼‰
	é—®é¢˜ï¼šçˆ¶ç»„ä»¶å†…é‡æ–°æ¸²æŸ“æ—¶ï¼Œé‡æ–°å£°æ˜äº†ä¸€ä¸ªä¸åŒçš„å‡½æ•°ã€‚æ‰€ä»¥**å­ç»„ä»¶è®¤ä¸ºpropsæ”¹å˜äº†**ã€‚
	æ–¹æ¡ˆï¼šå°†éœ€è¦ä¸‹ä¼ çš„å›è°ƒä½¿ç”¨useCallbackåŒ…è£¹ã€ä»…å¤„ç†ä¸‹ä¼ çš„å‡½æ•°ã€‘
## ä½¿ç”¨æ—§å€¼æ›´æ–°çŠ¶æ€
```js
function TodoList() {
  const [todos, setTodos] = useState([]);
  // stateçš„æ›´æ–°ä¾èµ–äºä¹‹å‰çš„state
  const handleAddTodo = useCallback((text) => {
    // æ¯æ¬¡todosæ›´æ–°ï¼Œéƒ½ä¼šä¿å­˜ä¸‹æ¥
    const newTodo = { id: nextId++, text };
    setTodos([...todos, newTodo]);
  }, [todos]);
```
ä¹Ÿå¯ä»¥é€šè¿‡æ›´æ–°å‡½æ•°ï¼Œå»ä½¿ç”¨ä¸Šæ¬¡çš„å€¼
```js
function TodoList() {
  const [todos, setTodos] = useState([]);

  const handleAddTodo = useCallback((text) => {
    const newTodo = { id: nextId++, text };
    setTodos(todos => [...todos, newTodo]);
  }, []); // âœ… No need for the todos dependency
```
## é¿å…å‰¯ä½œç”¨é‡å¤æ‰§è¡Œ/å‰¯ä½œç”¨çš„ä¾èµ–æ˜¯å‡½æ•°æ—¶
é—®é¢˜ï¼šå¦‚æœå‡½æ•°å£°æ˜æ”¾åœ¨å¤–é¢ï¼Œåœ¨å‰¯ä½œç”¨å†…è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¯èƒ½å¯¼è‡´å¤šæ¬¡è°ƒç”¨
```js
function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  function createOptions() {
    return {
      serverUrl: 'https://localhost:1234',
      roomId: roomId
    };
  }
  // åˆ›å»ºä¸€ä¸ªæ–°çš„æˆ¿é—´è¿æ¥
  useEffect(() => {
    const options = createOptions();
    const connection = createConnection();
    connection.connect();
    // ...
```
createOptionsæ¯æ¬¡çš„è¿”å›å€¼ä¸åŒï¼Œæ‰€ä»¥æ¯æ¬¡æ¸²æŸ“éƒ½å¿…é¡»è·å¾—æœ€æ–°çš„å‡½æ•°
æ–¹æ¡ˆ
	1. å°†createOptionsæ·»åŠ åˆ°ä¾èµ–åˆ—è¡¨ï¼šæ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºæ¯æ¬¡æ›´æ–°éƒ½ä¼šåˆ›å»ºï¼Œæ‰€ä»¥å‰¯ä½œç”¨æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œ
	2. å°†createOptionsç¼“å­˜åï¼Œæ·»åŠ åˆ°ä¾èµ–åˆ—è¡¨ï¼šå¯ä¿è¯ä»…åœ¨å‡½æ•°æ›´æ–°æ—¶ï¼Œå‰¯ä½œç”¨é‡æ–°æ‰§è¡Œã€‚
	3. ä¸ä½¿ç”¨å‡½æ•°ä¾èµ–ï¼Œå°†éœ€è¦ä¾èµ–state/propsæ›´æ–°çš„å‡½æ•°å£°æ˜æ”¾åœ¨å‰¯ä½œç”¨å†…éƒ¨
```js
function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  useEffect(() => {
    function createOptions() { // âœ… No need for useCallback or function dependencies!
      return {
        serverUrl: 'https://localhost:1234',
        roomId: roomId
      };
    }

    const options = createOptions();
    const connection = createConnection();
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]); // âœ… Only changes when roomId changes
  // ...
```
## ä¼˜åŒ–è‡ªå®šä¹‰Hook
å°†ä»»æ„å‡½æ•°å£°æ˜æ”¾åœ¨useCallbackä¸­
```js
function useRouter() {
  const { dispatch } = useContext(RouterStateContext);

  const navigate = useCallback((url) => {
    dispatch({ type: 'navigate', url });
  }, [dispatch]);

  const goBack = useCallback(() => {
    dispatch({ type: 'back' });
  }, [dispatch]);

  return {
    navigate,
    goBack,
  };
}
```
# useLayout

# useReducer
å¦ä¸€ç§useStateã€‚ä¸å®ƒæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿï¼Ÿï¼Ÿ
	1. ç›¸ä¼¼
		1. ä¿®æ”¹çŠ¶æ€
		2. è¿”å›ä¸€ä¸ªæ•°ç»„ï¼šstateã€ä¿®æ”¹è¯¥stateçš„æ–¹æ³•
	2. ä¸åŒ
		1. å°†stateæ”¹å˜æ—¶ç›¸å…³é€»è¾‘å°è£…åœ¨ä¿®æ”¹æ–¹æ³•å†…
		2. éœ€æ±‚ï¼šç›¸å¯¹useStateï¼Œè¾ƒä¸º**å¤æ‚çš„çŠ¶æ€**ã€‚
			1. çŠ¶æ€çš„æ–°å€¼ä¾èµ–äºæ—§å€¼
			2. çŠ¶æ€ä¾èµ–äºå¦ä¸€ä¸ªstate
			3. åŒ…å«å¤šä¸ªå­å€¼
			4. èƒ½ç»™è§¦å‘äº†æ·±æ›´æ–°çš„ç»„ä»¶è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€ï¼Ÿä¸æ‡‚ã€‘
å½¢å¼
	1. å®šä¹‰ï¼š`const [state, dispatch] = useReducer( reducer, initialValue )` 
	2. è°ƒç”¨ï¼š
# useContext
åŠŸèƒ½ï¼šåœ¨å‡½æ•°ç»„ä»¶ä¸­è¯»å–ä¸€ä¸ªç»„ä»¶ä¸­çš„[[context]]ã€‚
# useImperativeHandle
ç›®çš„ï¼šçˆ¶ç»„ä»¶è·å¾—å­å‡½æ•°ç»„ä»¶çš„**çŠ¶æ€å’Œæ–¹æ³•** 

å¯¹æ¯”ï¼šforwardRefç»“åˆrefæ˜¯æ‹¿åˆ°å­å‡½æ•°ç»„ä»¶ä¸­çš„**å…ƒç´ ** 
# è‡ªå®šä¹‰hook
```js
import React from 'react';
// å®šä¹‰æ£€æµ‹åœ¨çº¿çŠ¶æ€çš„hook
function useOffline() {
  const [isOffline, setIsOffline] = React.useState(false);

  function onOffline() {
    setIsOffline(true);
  }

  function onOnline() {
    setIsOffline(false);
  }

  React.useEffect(() => {
    window.addEventListener('offline', onOffline);
    window.addEventListener('online', onOnline);

    return () => {
      window.removeEventListener('offline', onOffline);
      window.removeEventListener('online', onOnline);
    };
  }, []);
// è¿”å›åœ¨çº¿çŠ¶æ€
  return isOffline;
}
// åœ¨æ•´ä¸ªåº”ç”¨å±‚çº§è°ƒç”¨
function App() {
  const isOffline = useOffline();

  if (isOffline) {
    return <div>Sorry, you are offline ...</div>;
  }

  return <div>You are online!</div>;
}

export default App;
```
#  å…¶ä»–API
React.memoï¼šç”¨äºç¼“å­˜å‡½æ•°ç»„ä»¶ï¼Œå¯¹ä¸¤æ¬¡æ¸²æŸ“çš„propsè¿›è¡Œæµ…å±‚æ¯”è¾ƒï¼Œå¦‚æœç›¸åŒåˆ™ä¸ä½œæ›´æ–°ã€‚
# æ¡ˆä¾‹
1. å€’è®¡æ—¶
```js
import React, { useState, useEffect, useRef } from "react";

export default function CountDown() {
  const maxTime = 60;
  const [countDownText, setCountDownText] = useState("è·å–éªŒè¯ç ");
  const [timerNum, setTimerNum] = useState(maxTime);
  const [boolCountDown, setBoolCountDown] = useState(false);
  const refCountDown = useRef(null);
  const handleClick = () => {
    if (!boolCountDown) {
      setBoolCountDown(true);
    }
  };

  refCountDown.current = () => {
  // ä¸ºä»€ä¹ˆåœ¨è¿™é‡Œè¯»å–çš„å°±æ˜¯æ›´æ–°åçš„å€¼
  // å› ä¸ºè¿™é‡Œæ¯æ¬¡é‡æ–°å£°æ˜äº†ä¸€ä¸ªå‡½æ•°ï¼Œå†…éƒ¨æ•è·åˆ°äº†æœ€æ–°çš„state
    if (timerNum > 0) {
      setTimerNum(timerNum - 1);
    } else {
      setTimerNum(maxTime);
      setBoolCountDown(false);
      setCountDownText("é‡æ–°è·å–");
    }
  };

  // const otherCountDown = () => {
  // ä¸ºä»€ä¹ˆåœ¨è¿™é‡Œè¯»å–çš„å°±ä¸€ç›´æ˜¯åˆå§‹å€¼
  // å› ä¸ºå®šæ—¶å™¨æ˜¯å¼‚æ­¥çš„ã€‚ç¬¬ä¸€æ¬¡æ‰§è¡Œeffectæ—¶è¿™é‡Œè¯»å–åˆ°timerNumæ˜¯60ï¼Œ
  //   console.log(timerNum, "timerNum");
  //   setTimerNum((timerNum) => timerNum - 1);
  // };

  useEffect(() => {
    if (boolCountDown) {
      const timer = setInterval(() => {
        // otherCountDown();
        refCountDown.current();
      }, 1000);
      return () => clearInterval(timer);
    }
  }, [boolCountDown]);

  return (
    <div>
      <button type="button" onClick={handleClick}>
        {boolCountDown ? `${timerNum}s` : countDownText}
      </button>
    </div>
  );
  
// åˆ†æéœ€æ±‚ï¼šç‚¹å‡»æ—¶ï¼šåˆ‡æ¢å±•ç¤ºå€’è®¡æ—¶æˆ–æ–‡æ¡ˆ
æ¯æ¬¡å€’è®¡æ—¶å‡1såï¼Œåˆ¤æ–­å€’è®¡æ—¶æ˜¯å¦æ˜¯0ã€‚å¦‚æœæ˜¯0ï¼Œé‡ç½®ç‚¹å‡»å¸ƒå°”ã€å½“å‰æ—¶é—´ã€‚å¦‚æœä¸æ˜¯0ï¼Œå‡1
```
1. [blissful-colden-5vmuw - CodeSandbox](https://codesandbox.io/s/blissful-colden-5vmuw)ï¼šç”¨å‡½æ•°ç»„ä»¶å®ç°ä¸€ä¸ªå®šæ—¶å™¨ã€‚
# æ€»ç»“
1. useMemoï¼šä¿å­˜**ä¼ å…¥å‡½æ•°çš„è¿”å›å€¼**ï¼Œé¿å…é‡æ–°ç”Ÿæˆ
	1. ç”¨äºç»„ä»¶ã€‚è¢«React.memoçš„ç»„ä»¶å¯é¿å…*å±æ€§æœªæ”¹å˜*æ—¶é‡æ–°æ¸²æŸ“
		1. å¦‚æœå±æ€§ä¼ é€’çš„å¼•ç”¨ç±»å‹ï¼Œå­ç»„ä»¶ä»ä¼šæ›´æ–°ã€‚
			1. ä½¿ç”¨useMemoä¿å­˜è¯¥å¼•ç”¨ç±»å‹å€¼ï¼š`const info = useMemo(() => ({ name, age }), [name, age]);`[^2] 
	2. ç”¨äºå€¼ã€‚éœ€è¦å¤§é‡è®¡ç®—è¿‡ç¨‹ï¼Œæˆ–å¾ˆå°‘æ”¹å˜çš„å€¼ã€‚
	3. å¦‚æœå‡½æ•°çš„è¿”å›å€¼æ˜¯å¦ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™ç±»ä¼¼useCallback
2. useCallbackï¼šä¿å­˜**ä¼ å…¥å‡½æ•°**ï¼Œé¿å…é‡æ–°ç”Ÿæˆ
	1. é¿å…æ¯æ¬¡å› ä¸ºçˆ¶ç»„ä»¶æ›´æ–°è€Œç”Ÿæˆæ–°çš„å‡½æ•°
		1. å‘å·²memoçš„å­ç»„ä»¶ä¼ é€’å›è°ƒ
3. useCallbackæ˜¯useMemoçš„å­é›†ï¼Œå› ä¸ºå‡½æ•°ä¹Ÿæ˜¯å€¼ã€‚å½“useMemoä¸­å›è°ƒçš„è¿”å›å€¼æ˜¯å‡½æ•°æ—¶ï¼Œç®€æ´å†™æ³•æ˜¯ä½¿ç”¨useCallbackã€‚
# ç»„ä»¶
## å®šä¹‰
1. å¯¼å‡ºç»„ä»¶å‰ä½¿ç”¨React.memoåŒ…è£¹ç»„ä»¶ã€ä»…å¯¹æ¯”åŸå§‹ç±»å‹æ•°æ®æ¯”è¾ƒå¥½ç”¨ï¼Œå¼•ç”¨ç±»å‹ã€‘

## è°ƒç”¨
1. ä½¿ç”¨useCallbackåŒ…è£¹éœ€è¦ä¸‹ä¼ çš„å›è°ƒ
2. ä½¿ç”¨useMemoåŒ…è£¹éœ€è¦ä¸‹ä¼ çš„éå‡½æ•°çš„å€¼

[^1]: è¢«ä¿å­˜åœ¨reactä¸­ï¼Œç­‰å¾…ä¸‹æ¬¡æ›´æ–°è¿‡ç¨‹ä¸­è°ƒç”¨
[^2]: ä»…å½“ç›®æ ‡å€¼æ”¹å˜æ—¶å†ç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„å¼•ç”¨å€¼
[^3]: åŸç”Ÿå…ƒç´ ï¼Œå¦‚inputï¼Œå¯ç›´æ¥é€šè¿‡ç»‘å®šrefå±æ€§è·å¾—è¯¥å…ƒç´ 
[^4]: å¯ä»ä¸¤ä¸ªæ–¹é¢é¿å…çˆ¶ç»„ä»¶æ›´æ–°çš„é‡æ¸²æŸ“ï¼šåŸºç¡€å€¼å’Œå¼•ç”¨å€¼