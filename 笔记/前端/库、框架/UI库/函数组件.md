# æ¦‚è¿°
æœŸæœ›ä¸€ä¸ªçº¯å‡½æ•°ï¼Œï¼ˆreactåªéœ€ä»ä¸Šåˆ°ä¸‹æ‰§è¡Œå®ƒï¼‰ï¼Œæ¥æ”¶ç›¸åŒå‚æ•°ï¼ˆpropsã€state å’Œ contextï¼‰ï¼Œè¿”å›ç›¸åŒçš„JSX
1. ç›®çš„ï¼šä¸ºäº†åœ¨å‡½æ•°ç»„ä»¶ä¸­ä½¿ç”¨[[çŠ¶æ€]]ä¸[[å‰¯ä½œç”¨]]ï¼ˆå‡½æ•°ç»„ä»¶æ›¾è¢«åŒºåˆ«ç§°ä¸ºâ€œæ— çŠ¶æ€ç»„ä»¶â€ï¼‰æ—¶ï¼Œä¸ç”¨å†é‡æ„ä¸º [[classç»„ä»¶]] ã€‚
2. ç‰¹ç‚¹
	1. [[çº¯å‡½æ•°]]ï¼Œè¾“å…¥ propsï¼Œè¾“å‡º[[JSX]] ã€‚
		1. æ‰§è¡Œå®Œå³é”€æ¯ï¼Œæ— æ³•å­˜å‚¨ stateã€‚é€šè¿‡ statehook,æŠŠ state åŠŸèƒ½æ·»åŠ åˆ°çº¯å‡½æ•°ä¸­
	2. æ²¡æœ‰å®ä¾‹ã€ç”Ÿå‘½å‘¨æœŸã€state
	3. ä¸èƒ½æ‰©å±•å…¶ä»–æ–¹æ³•
3. [[classç»„ä»¶]] çš„é—®é¢˜
	1. å¤§å‹[[ç»„ä»¶]]éš¾ä»¥*æ‹†åˆ†é‡æ„ï¼Œæµ‹è¯•*ï¼ˆå³ class ä¸æ˜“æ‹†åˆ†ï¼‰
	2. ç›¸åŒçš„å‰¯ä½œç”¨*é€»è¾‘åˆ†æ•£*çš„å„ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæ··ä¹±
		1. è·³è¿‡å‰¯ä½œç”¨æ—¶éœ€è¦å¯¹æ¯”æ–°æ—§ state æˆ– propsã€‚
	3. *é€»è¾‘å¤ç”¨*å¤æ‚ã€‚mixins, hoc, render-props
4. æ„ä¹‰
	1. å‘æ˜ hooks çš„åŠ¨æœº
		1. å‡½æ•°ç»„ä»¶é‡æ„
			1. åœ¨æ— çŠ¶æ€ç»„ä»¶éœ€è¦æ·»åŠ çŠ¶æ€æ—¶ï¼Œä¸å†éœ€è¦é‡æ„ä¸ºç±»ç»„ä»¶
		2. é€»è¾‘å¤ç”¨
	2. å®ƒå¦‚ä½•æ”¹å˜äº†react
		1. ä»£ç ç»„ç»‡ï¼šä»¥æ¸²æŸ“ä¸ºæ ¸å¿ƒç»„ç»‡ä»£ç ã€‚æ—¢ç„¶ä¸€ä¸ªå‰¯ä½œç”¨æœ‰å®ƒè‡ªå·±çš„è®¾ç½®å’Œæ¸…é™¤é˜¶æ®µï¼Œå°±æŠŠå®ƒæ”¾åœ¨åŒä¸€ä¸ª hook ä¸­
		2. contextçš„æŠ½è±¡ï¼ŒHOCä¸render propsçš„æŠ½è±¡ï¼Œéƒ½å¢åŠ äº†ç»„ä»¶çš„*åµŒå¥—åœ°ç‹±*ã€‚
			1. å½¢æˆäº†å¯è¯»æ€§å¾ˆå·®çš„ç»„ä»¶æ ‘ï¼Œå› ä¸ºæ‰€æœ‰çš„æŠ½è±¡é€»è¾‘éƒ½ç”¨ç»„ä»¶å®ç°ï¼Œå®é™…ç”¨äºå±•ç¤ºçš„ç»„ä»¶å´å¾ˆéš¾è¿½è¸ª
			2. å°†è¿™äº›å¹¶éç”¨äºå±•ç¤ºçš„ç»„ä»¶ï¼ˆé€»è¾‘ç»„ä»¶ï¼‰ä½¿ç”¨å‰¯ä½œç”¨å°è£…ã€‚å°±æ‰“å¹³äº†ç»„ä»¶æ ‘çš„ç»“æ„
	3. å¦‚ä½•æ¨¡æ‹Ÿ [[classç»„ä»¶]] çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ
5. å‰æï¼šå¦‚æœä¸ç†è§£Functionã€çº¯å‡½æ•°ã€[[å‰¯ä½œç”¨]]ï¼Œå°±æ— æ³•ç†è§£reactå¤„ç†å‡½æ•°ç»„ä»¶çš„æ–¹å¼ã€‚
		1. æˆ‘ä»¬åˆ›å»ºçš„ç»„ä»¶å¯èƒ½æ˜¯çº¯å‡½æ•°ï¼Œä¹Ÿä¼šæ˜¯éçº¯å‡½æ•°ã€‚å…³é”®åœ¨äºè¦çŸ¥é“è‡ªå·±æ­£åœ¨åˆ›å»ºä»€ä¹ˆå‰¯ä½œç”¨ã€‚
## ä½¿ç”¨æ¡ä»¶
1. åœ¨**å‡½æ•°ç»„ä»¶æˆ–è‡ªå®šä¹‰ hookå†…**çš„**æœ€é¡¶å±‚**[[ä½œç”¨åŸŸ]]ã€‚
	1. é¡¶å±‚èƒ½ä¿è¯ Hook æ¯æ¬¡æ¸²æŸ“éƒ½æŒ‰*é¡ºåºè°ƒç”¨*ã€‚åœ¨æ¡ä»¶è¯­å¥ä¸­ä¼šå¯¼è‡´é¡ºåºæ”¹å˜ï¼Œ
	2. ä¸ºä½• hooks ä¾èµ–äºè°ƒç”¨é¡ºåºï¼Ÿ
		1. å‡½æ•°ç»„ä»¶æ¯æ¬¡æ‰§è¡Œæ—¶ï¼Œéƒ½éœ€è¦*æ ¹æ® hooks çš„æ‰§è¡Œé¡ºåº*ç»´æŠ¤ä¸€ä¸ªé˜Ÿåˆ—ï¼šstate å˜é‡ä¸å€¼çš„å¯¹åº”å…³ç³»
			1. å¦‚æœé¡ºåºå­˜åœ¨ä¸ç¡®å®šæ€§ï¼ˆè¯­å¥ï¼Œç»„ä»¶æå‰ returnï¼‰ä¼šå¯¼è‡´ react æ— æ³•æ­£ç¡®å…³è”å†…éƒ¨ state ä¸å¯¹åº”çš„ hook è°ƒç”¨
2. å¯é€šè¿‡ä½¿ç”¨ `eslint-plugin-react-hooks` æ’ä»¶è§„èŒƒ hook çš„ä½¿ç”¨![[Pasted image 20230729172618.png]] 
## æ€»ç»“
1. è¯´å‡ºæ‰€æœ‰å†…ç½® hooks åŠå…¶åŠŸèƒ½ï¼Ÿ
	1. çŠ¶æ€ï¼šuseState, useDeferredValue, useDebugValue, useReducer, useId, useMemo, useCallback
	2. å‰¯ä½œç”¨ï¼šuseEffect, useLayoutEffect, useInsertionEffect
	3. ä¼ é€’ï¼šuseRefï¼Œ useImperativeHandle
	4. å…¶å®ƒï¼šuseId, useParams, 
# åŸç†
## å®šä¹‰
æ¥æ”¶ä¸¤ä¸ªå±æ€§ï¼šprops, ref
1. propsï¼šã€å‘å†…ä¼ é€’ã€‘
2. ref
	1. èšç„¦æ–‡å­—è¾“å…¥æ¡†
	2. æ»šåŠ¨å›¾ç‰‡åˆ°è§†å›¾
	3. æ’­æ”¾å’Œæš‚åœè§†é¢‘ 
	4. çˆ¶ç»„ä»¶çº§åˆ«å¾—åˆ°*è‡ªå®šä¹‰ç»„ä»¶*[^3]å†…çš„DOMå…ƒç´ 
		1. å°†è¯¥å‚æ•°ä½œä¸ºæŸä¸ªç»„ä»¶çš„refå±æ€§å€¼
		2. ä½¿ç”¨react.forwardRefå‡½æ•°åŒ…è£¹ï¼Œå°†å…¶æš´éœ²ç»™çˆ¶ç»„ä»¶
## æ‰§è¡Œ
1. æŒ‚è½½ã€ç»„ä»¶æŒ‚è½½åˆ°DOMç»“æ„ä¸­ã€‘
	1. æ‰§è¡Œéæ¸²æŸ“ä»£ç 
		1. useStateï¼š*åˆå§‹å€¼*ä½œä¸ºæœ€æ–°å¸¸é‡è¿”å›ï¼Œç”Ÿæˆ*åªå±äºæ­¤æ¬¡æ¸²æŸ“*çš„ï¼ˆstate+props+eventHandlerï¼‰
		2. useEffect
			1. æ•è·æ‰€æœ‰ä¾èµ–å˜é‡
			2. æ·»åŠ éœ€è¦è¢«æ‰§è¡Œå’Œæ¸…é™¤çš„å‰¯ä½œç”¨[^1] 
	2. æ‰§è¡Œæ¸²æŸ“ä»£ç 
		1. æ‰§è¡Œreturnï¼Œè¯»å–æ­¤æ¬¡æ‰§è¡Œæ—¶ä½¿ç”¨props, state, eventHandleræ‰€ç”Ÿæˆçš„**å¿«ç…§**ï¼Œå¹¶ä¾æ®è¯¥å¿«ç…§ç”ŸæˆUIçš„å¿«ç…§ã€‚
	3. æ¸²æŸ“å®Œæ¯•
	4. æ‰§è¡ŒuseEffectä¸­æ·»åŠ çš„[[å‰¯ä½œç”¨]] 
		1. useEffectä½¿ç”¨å…¨æ–°çš„propsï¼Œstateç»‘å®šå‰¯ä½œç”¨
2. æ›´æ–°ã€ç»„ä»¶æ›´æ–°ã€‘
	1. æ‰§è¡Œéæ¸²æŸ“ä»£ç 
		1. useStateï¼š*setStateä¼ å…¥å€¼*ä½œä¸ºæœ€æ–°å¸¸é‡è¿”å›ï¼Œç”Ÿæˆ*åªå±äºæ­¤æ¬¡æ¸²æŸ“*çš„ï¼ˆstate+props+eventHandlerï¼‰
		2. useEffectã€å¦‚æœ**ä¾èµ–æ²¡æœ‰æ›´æ–°**ï¼Œåˆ™**ä¸æ‰§è¡Œ**ã€‘
	2. æ‰§è¡Œæ¸²æŸ“ä»£ç 
	3. æ¸²æŸ“å®Œæ¯•
	4. æ£€æŸ¥é˜Ÿåˆ—
		1. å¦‚æœæœ‰
			1. æ‰§è¡Œæ¸²æŸ“å‰æ·»åŠ çš„æ¸…é™¤å‰¯ä½œç”¨ã€å› ä¸ºå¤§å¤šæ•°effectçš„æ‰§è¡Œå¹¶ä¸ä¼šé˜»å¡DOMæ›´æ–°ï¼Œæ‰€ä»¥å…ˆæ¸…é™¤ã€‘
			2. æ‰§è¡Œæ¸²æŸ“å‰æ·»åŠ çš„å‰¯ä½œç”¨ã€å¦‚æœè¢«è·³è¿‡ï¼Œåˆ™ä¸æ‰§è¡Œã€‘
3. å¸è½½
	1. æ¸…é™¤å‰¯ä½œç”¨
ç‰¹ç‚¹
	1. æ¯æ¬¡æ¸²æŸ“ï¼Œéƒ½æ˜¯ç‹¬ç«‹çš„é—­åŒ…ã€‚
		1. æ‹¥æœ‰å±äºæ­¤æ¬¡æ¸²æŸ“çš„ï¼ˆstate+props+eventHandler+ç»„ä»¶UI+é€»è¾‘ï¼‰
		2. æ•è·çš„å€¼ä¸ä¼šå—åç»­æ“ä½œçš„å½±å“
# useStateï¼šçŠ¶æ€
æœ¬è´¨ï¼šå°†æœ¬åœ°çš„[[çŠ¶æ€]]å°è£…åœ¨å‡½æ•°[[ç»„ä»¶]]ä¸­ã€‚
å½¢å¼ï¼šconst [state, setState] = useState(initialValue)
	1. stateï¼šä¿å­˜*çŠ¶æ€*çš„å˜é‡
		1. æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šè°ƒç”¨ã€‚æŒ‚è½½æ—¶è¿”å›InitialValueï¼Œæ›´æ–°æ—¶è¿”å›æœ€æ–°setçš„å€¼
	2. setStateï¼šä¿å­˜*ä¿®æ”¹çŠ¶æ€çš„å‡½æ•°*çš„å˜é‡
		1. [[Function]]ï¼šå»è·å–å½“å‰ç»„ä»¶ä¸­ç»´æŠ¤çš„æœ€æ–°çš„çŠ¶æ€å€¼ï¼ˆå¹¶ä¸æ˜¯æ­¤æ¬¡æ¸²æŸ“çš„å€¼ï¼‰
			1. setCount(count => count + 1)
			2. è¯»å–reactä¸­ç»´æŠ¤çš„**æœ€æ–°å€¼**ï¼Œè€Œä¸æ˜¯æ­¤æ¬¡æ¸²æŸ“ä¸­çš„å€¼ã€‚å³ä½¿å½“å‰æ¸²æŸ“çš„stateå¹¶æ²¡æœ‰æ›´æ–°ï¼Œæ˜¯åœ¨å®šæ—¶å™¨ä¸­ä¿®æ”¹çš„ï¼Œä¹Ÿå¯è¯»å–ã€‚
			3. **stateçš„æ›´æ–°ä¾èµ–äºæ—§å€¼**ã€æ­¤æ—¶[[å‡½æ•°ç»„ä»¶#useReducer|userReducer]]å¯èƒ½æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‘
		2. [[å€¼]]ï¼šå½“å‰è¯»å–åˆ°çš„ï¼ˆå¯èƒ½æ˜¯æ—§å€¼ï¼‰
	3. initialValueï¼šçŠ¶æ€çš„åˆå§‹å€¼
		1. [[Function]]ï¼šæƒ°æ€§åˆå§‹åŒ–ï¼šåˆå§‹åŒ–æ—¶è°ƒç”¨ï¼Œè®¾ç½®è¿”å›å€¼ä¸ºåˆå§‹å€¼
		2. [[å€¼]] 
æ‰§è¡Œæœºåˆ¶
	1. æ¯æ¬¡æ¸²æŸ“æ—¶ï¼Œå°†åˆå§‹å€¼ï¼ˆæŒ‚è½½ï¼‰æˆ–é€šè¿‡setStateä¼ å…¥çš„å€¼ï¼ˆæ›´æ–°ï¼‰å£°æ˜ä¸ºå½“å‰ç»„ä»¶å†…çš„**å¸¸é‡**ã€‚
> [!note] åŸç†
> 

1. ä»reactä¸­å¯¼å…¥ï¼Œä½†ä¸æ˜¯åœ¨è¿™ä¸ªåŒ…ä¸­å®ç°çš„ï¼Œè€Œæ˜¯åœ¨react-reconcilerã€‚
	1. åœ¨try/catchä¸­ï¼Œä½¿ç”¨äº†mountStateï¼ˆinitialValueï¼‰æ–¹æ³•
	2. å…³é”®æ˜¯mountStateçš„å®ç° [[useStateåŸç†.png]] 
2. å¤šä¸ªè°ƒç”¨ï¼Œå¦‚ä½•ä¿è¯æŒ‰é¡ºåºæ‰§è¡Œï¼Ÿ
	1. åˆå§‹åŒ–æ—¶
		1. æ¯æ¬¡è°ƒç”¨ï¼šéƒ½ä¼šè¿”å›ä¸€ä¸ªhookå¯¹è±¡ã€ç”Ÿæˆä¸€å¯¹state/setteræ˜ å°„ã€‚
		2. æ¯æ¬¡æ¸²æŸ“ï¼šéƒ½ä¼šæŒ‰ç…§*åˆå§‹åŒ–çš„åºåˆ—*éå†*ç”±å¤šä¸ªæ˜ å°„ç»„æˆçš„æ•°ç»„*ã€‚
	2. åˆå§‹åŒ–stateæ—¶ï¼Œä¸èƒ½åœ¨æ¡ä»¶è¯­å¥ä¸­ï¼Œå› ä¸ºæ¯æ¬¡æ‰§è¡Œéƒ½æ˜¯æŒ‰ç…§åˆå§‹åŒ–çš„é¡ºåºæ‰§è¡Œã€‚å­˜åœ¨æ¡ä»¶è¯­å¥åˆ™æ•°ç»„é¡ºåºå¯èƒ½ä¸åŒã€‚
# useReducerï¼šçŠ¶æ€
function reducer(state, action){}
const \[state, dispatch] = useReducer(reducer, initialState, initialFunc?)
åŠŸèƒ½ï¼šç»™ç»„ä»¶æ·»åŠ ä¸€ä¸ªreducer
ä½¿ç”¨
	1. state åˆå§‹å€¼
		1. å¦‚æœåˆå§‹å€¼éœ€è¦ç»è¿‡è®¡ç®—ï¼Œä¸è¦åœ¨ç¬¬äºŒä¸ªå‚æ•°ç›´æ¥ä¼ å…¥å‡½æ•°ï¼Œå› ä¸ºåç»­æ›´æ–°ä¹Ÿä¼šè°ƒç”¨ï¼Œå³ä½¿ä¸ç”Ÿæ•ˆ
		2. ç¬¬ä¸‰ä¸ªï¼šç”¨äºåˆå§‹åŒ–å€¼çš„å‡½æ•°
		3. ç¬¬äºŒä¸ªï¼šåˆå§‹åŒ–å‡½æ•°éœ€è¦ä½¿ç”¨çš„å‚æ•°
	2. reducer å‡½æ•°è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œç”¨äºæ›´æ–° state
		1. stateåªè¯»ï¼Œä¸è¦ä¿®æ”¹å®ƒçš„å±æ€§
		2. è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼ŒåŒ…å«è§£æ„åçš„stateå’Œæ–°å±æ€§
	3. è°ƒç”¨dispatchæ—¶ä¼ å…¥çš„å¯¹è±¡ï¼Œä¼šæˆä¸ºreducerè°ƒç”¨çš„ç¬¬äºŒä¸ªå‚æ•°

å¦ä¸€ç§useStateã€‚ä¸å®ƒæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿï¼Ÿï¼Ÿ
	1. ç›¸ä¼¼
		1. ä¿®æ”¹çŠ¶æ€
		2. è¿”å›ä¸€ä¸ªæ•°ç»„ï¼šstateã€ä¿®æ”¹è¯¥stateçš„æ–¹æ³•
	2. ä¸åŒ
		1. å°† state *æ›´æ–°é€»è¾‘å°è£…*åœ¨ reducer å†…ï¼Œåœ¨å›è°ƒæ—¶åªéœ€è°ƒç”¨ dispatch å¹¶ä¼ å‚ã€‚
		2. åœºæ™¯ï¼šç›¸å¯¹ useStateï¼Œè¾ƒä¸º**å¤æ‚çš„çŠ¶æ€**ã€‚
			1. çŠ¶æ€çš„*æ–°å€¼ä¾èµ–*äºæ—§å€¼ï¼Œæˆ–ä¾èµ–äºå¦ä¸€ä¸ªçŠ¶æ€
			3. åŒ…å«*å¤šä¸ªå­å€¼* 
			4. èƒ½ç»™è§¦å‘äº†*æ·±æ›´æ–°*çš„ç»„ä»¶è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€ï¼Ÿä¸æ‡‚ã€‘
# useDeferredValueï¼šUIæ›´æ–°é—´éš”
ç›®çš„ï¼š**å»¶è¿Ÿæ¸²æŸ“**ä¸€ä¸ªæ›´æ–°è¾ƒæ…¢çš„ UI 
	1. ç»„ä»¶ä»£ç é‡å¤§
	2. ç»„ä»¶æ‰€ä½¿ç”¨çš„æ¥å£è¾ƒæ…¢
	3. ç»„ä»¶å±•ç¤ºä¾èµ–å¤§é‡æ•°æ®ã€‚ç»„ä»¶æ–°å¿«ç…§ç”Ÿæˆä¹‹å‰ä½¿ç”¨æ—§å€¼ã€è€Œä¸æ˜¯*å±•ç¤ºç©ºç™½*ã€‘
æœºåˆ¶
	1. æŒ‚è½½æ—¶ä½¿ç”¨ä¼ å…¥çš„å€¼æ¸²æŸ“
	2. æ›´æ–°æ—¶
		1. å…ˆä½¿ç”¨æ—§å€¼é‡æ¸²æŸ“ï¼Œåœ¨åå°ä½¿ç”¨æ–°å€¼é‡æ¸²æŸ“
		2. ä¼˜å…ˆæ¸²æŸ“å…¶å®ƒç»„ä»¶ï¼Œæœ€åæ¸²æŸ“ä½¿ç”¨ useDeferredValue çš„ç»„ä»¶
		3. é¿å…æ¸²æŸ“è¾ƒæ…¢çš„ UI é˜»å¡å…¶ä»– UI æ¸²æŸ“ 
ç”¨é€”
```js
function SearchPage() {
  const [query, setQuery] = useState('');
  // ä¼ å…¥stateå˜é‡
  const deferredQuery = useDeferredValue(query);
  // ...
}
```
ç»“æœ
	1. æ–°UIæœªç”Ÿæˆå‰ï¼Œä¸€ç›´æ˜¯æ—§çš„ï¼Œæ²¡æœ‰æç¤ºã€‚
		1. ç»“æœå‡ºæ¥å‰é™ä½äº®åº¦ï¼š`<div style={{opacity: query !== deferredQuery ? 0.5 : 1}}>` 
# useId
åŠŸèƒ½ï¼šç”Ÿæˆç‹¬ç‰¹çš„IDï¼Œä¼ é€’ç»™ `HTMLè¾…åŠ©åŠŸèƒ½å±æ€§` 
HTMLè¾…åŠ©åŠŸèƒ½å±æ€§ï¼šæŒ‡å®šä¸¤ä¸ªæ ‡ç­¾å½¼æ­¤ç›¸å…³ã€‚å¦‚ï¼Œä¸€ä¸ªpå…ƒç´ æè¿°å¦ä¸€ä¸ªinputå…ƒç´ çš„è¾“å…¥æ ¼å¼è¦æ±‚ã€‚
`const id = useId()` 
	1. ä¸éœ€è¦å‚æ•°
	2. è¿”å›ä¸€ä¸ªå”¯ä¸€å€¼ï¼Œ
ç¡¬ç¼–ç ä¸æ˜¯ä¸€ç§å¥½çš„å®è·µï¼š[[ç¡¬ç¼–ç å…³è”å…ƒç´ .png]] å› ä¸ºç»„ä»¶å¯èƒ½è¢«è°ƒç”¨å¤šæ¬¡ï¼Œè€ŒIDå¿…é¡»æ˜¯å”¯ä¸€çš„ï¼
	1. å¦‚æœæ˜¯è¡¨å•ç»„ä»¶æ‰€éœ€çš„IDï¼Œä¼šå¯¼è‡´é‡å¤ã€‚
## åœºæ™¯
1. labelæ ‡ç­¾ä¸inputæ ‡ç­¾ã€‚htmlForå±æ€§ä¸idå±æ€§ç»‘å®šã€‚ç‚¹å‡»labelä¼šè‡ªåŠ¨focusè¾“å…¥æ¡†
2. åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­æ¸²æŸ“å¤šä¸ªreactåº”ç”¨
# useParams
è·å–åŠ¨æ€è·¯ç”±å‚æ•°
# useEffect
éœ€è¦åœ¨é¡µé¢æ¸²æŸ“åæ‰§è¡Œçš„[[å‰¯ä½œç”¨]] 
	1. æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ‰§è¡Œã€‚å³ä½¿ç”¨\[]ï¼Œä¹Ÿä¼šåœ¨åˆ·æ–°é¡µé¢æ—¶æ‰§è¡Œè¯¥å‰¯ä½œç”¨
> [!åŠŸèƒ½] 

## åŸç†
[éš”å£åŒäº‹ï¼šå§æ§½ï¼Ÿä½ å¯¹ useEffect çš„ç†è§£æ€ä¹ˆè¿™ä¹ˆç‰›é€¼ğŸ˜¡ğŸ˜¡ğŸ˜¡ - æ˜é‡‘](https://juejin.cn/post/7264208575973605431) 
ç›®çš„
	1. æä¾›ä¸€ç§ä¸“é—¨ç®¡ç†ç»„ä»¶ä¸­å‰¯ä½œç”¨çš„æ–¹å¼ã€‚
	2. ç»„ä»¶æŒ‚è½½/ä¾èµ–æ›´æ–°/æ²¡æœ‰ä¾èµ–æ—¶ï¼Œå¯¹ç»„ä»¶å†…çŠ¶æ€è¿›è¡Œ**æ•è·å¹¶æ’é˜Ÿ**ã€‚ç»„ä»¶æ¸²æŸ“åï¼Œå…ˆ**æ‰§è¡Œ**ä¸Šæ¬¡æ¸²æŸ“æ•è·çš„æ¸…é™¤é€»è¾‘ï¼Œå†æ‰§è¡Œæ­¤æ¬¡æ¸²æŸ“æ•è·çš„æ·»åŠ é€»è¾‘ã€‚
	3. ç»„ä»¶å¸è½½æ—¶ï¼Œæ‰§è¡Œä¸Šæ¬¡æ¸²æŸ“æ—¶æ•è·çš„æ¸…é™¤é€»è¾‘
å†…éƒ¨æœºåˆ¶
	1. DOM æ›´æ–°åæ‰§è¡Œ
	2. æ²¡æœ‰ä¾èµ–ï¼šæ¯æ¬¡æ¸²æŸ“ï¼ˆæ‰§è¡Œå‡½æ•°ä½œç”¨åŸŸä¸­ä»£ç åŠå‡½æ•°çš„ return å¹¶æ¸²æŸ“ï¼‰åæ‰§è¡Œ[[å‰¯ä½œç”¨]] 
		1. å…ˆæ‰§è¡Œä¸Šæ¬¡çš„å‰¯ä½œç”¨æ¸…é™¤
		2. å†æ‰§è¡Œæ­¤æ¬¡å‰¯ä½œç”¨çš„æ·»åŠ 
	3. ç©ºæ•°ç»„ï¼š**ä¸ä½¿ç”¨æ•°æ®æµä¸­çš„å€¼**ï¼Œåªåœ¨åˆæ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œçš„å‰¯ä½œç”¨
		1. æŒ‚è½½æ—¶ï¼šä¿å­˜æ·»åŠ ä¸æ¸…é™¤é€»è¾‘ã€‚æ¸²æŸ“å®Œæˆåæ‰§è¡Œæ·»åŠ é€»è¾‘ï¼Œå¸è½½æ—¶æ‰§è¡Œæ¸…é™¤é€»è¾‘
		2. å¸è½½æ—¶ï¼šæ‰§è¡Œæ¸…é™¤é€»è¾‘
	4. å­˜åœ¨ä¾èµ–ã€‚åˆæ¬¡æ¸²æŸ“æ—¶ã€åç»­ç‰¹å®š state æ›´æ–°æ—¶æ‰§è¡Œçš„å‰¯ä½œç”¨ã€‚
		1. æŒ‚è½½æ—¶ï¼šä¿å­˜æ·»åŠ ä¸æ¸…é™¤é€»è¾‘ã€‚æ¸²æŸ“å®Œæˆåæ‰§è¡Œæ·»åŠ é€»è¾‘ï¼Œå¸è½½æ—¶æ‰§è¡Œæ¸…é™¤é€»è¾‘
		2. ä¾èµ–æ›´æ–°
			1. æ‰€æœ‰çŠ¶æ€å’ŒDOMæ›´æ–°åï¼Œä¸Šæ¬¡æ¸²æŸ“æ—¶å®šä¹‰çš„æ¸…é™¤é€»è¾‘ã€‚
			2. æ˜¯æ­¤æ¬¡æ¸²æŸ“æ—¶æ•è·çš„æ·»åŠ é€»è¾‘
æ‰§è¡Œæœºåˆ¶ï¼šæ•è·å˜é‡ï¼Œå‰¯ä½œç”¨çš„æ·»åŠ é€»è¾‘åœ¨*æ­¤æ¬¡DOMå˜æ›´ã€æµè§ˆå™¨æ¸²æŸ“é¡µé¢å*æ‰§è¡Œï¼Œå‰¯ä½œç”¨çš„æ¸…é™¤é€»è¾‘åœ¨
	1. ä¾èµ–æ›´æ–°ï¼š*ä¸‹æ¬¡æ¸²æŸ“åã€æ–°å‰¯ä½œç”¨æ·»åŠ é€»è¾‘æ‰§è¡Œå‰*æ‰§è¡Œ
	2. ç»„ä»¶å¸è½½ï¼šç»„ä»¶å¸è½½å‰æ‰§è¡Œ
> [!note] åŸç†
> 
> 

1. **æ•è·**æ­¤æ¬¡æ¸²æŸ“æ—¶çš„propsä¸state
	1. ã€åœ¨å‰¯ä½œç”¨è®¾ç½®å‡½æ•°é‡Œï¼Œæ‹¿åˆ°çš„æ˜¯åˆå§‹çš„propsä¸stateã€‚*å¦‚æœæƒ³æ‹¿åˆ°æœ€æ–°å€¼*ã€‘
		1. æ·»åŠ åˆ°ä¾èµ–é˜Ÿåˆ—ã€ä»…å½“å‰¯ä½œç”¨éœ€è¦ä¾èµ–è¯¥stateæ—¶ã€‘
		2. ä½¿ç”¨useRefã€‚ä»å¤–ç•Œè·å–æœ€æ–°state
		3. åœ¨å‰¯ä½œç”¨çš„setStateä¸­ä¼ å…¥å‡½æ•°ã€‚
	2. æ¸…é™¤å‰¯ä½œç”¨æ—¶æ•è·çš„å€¼ä¼šåœ¨ä¸‹æ¬¡æ¸²æŸ“æ—¶è¢«è°ƒç”¨ã€‚
		1. æ­¤æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œçš„æ¸…é™¤é€»è¾‘ä¸­ï¼Œä¿å­˜çš„éƒ½æ˜¯ä¸Šæ¬¡æ¸²æŸ“çš„çŠ¶æ€
	3. ç›‘å¬å€¼æ²¡æœ‰æ”¹å˜ï¼Œæ‰€ä»¥è¯¥æ¬¡æ›´æ–°æ²¡æœ‰æ‰§è¡Œè¯¥effect
å½¢å¼ï¼š `useEffect(() => {}, [])` 
	1. []ï¼šè¯¥å‰¯ä½œç”¨ä¸ä½¿ç”¨[[React]]*æ•°æ®æµä¸­çš„å€¼*ã€‚åªåœ¨ç»„ä»¶*æŒ‚è½½æ—¶*è°ƒç”¨ä¸€æ¬¡ã€‚
	2. [a]ï¼šç»„ä»¶*æŒ‚è½½æ—¶ã€aæ”¹å˜*æ—¶ã€ä»…åœ¨æŸäº›çŠ¶æ€æ”¹å˜æ—¶æ‰§è¡Œçš„å‰¯ä½œç”¨ã€‘
	3. returnï¼š
	4. useEffect(()=>{})ï¼šæ¯æ¬¡çŠ¶æ€æ”¹å˜æ—¶ã€æ²¡æœ‰æ„ä¹‰ï¼Œè·Ÿç›´æ¥å†™åœ¨å¤–é¢ç›¸åŒã€‘
ç‰¹æ€§
	1. å¦‚æœä¾èµ–åˆ—è¡¨ä¸­æ²¡æœ‰ç›‘å¬æŸä¸ªstateï¼Œåˆ™ä¸ä¼šé‡æ–°æ•è·ï¼Œå¯¼è‡´æ¯æ¬¡è°ƒç”¨å‰¯ä½œç”¨æ—¶ä½¿ç”¨çš„éƒ½æ˜¯æ—§stateã€‚
		1. `setCount(count => count + 1)`ã€‚å­˜åœ¨é—®é¢˜ï¼šå¦‚æœæœ‰ä¸¤ä¸ªäº’ç›¸ä¾èµ–çš„çŠ¶æ€ï¼Œåˆ™ä¸èƒ½åšåˆ°ã€‚
		2. ä¸è¯¥æ–¹æ³•ç›¸ä¼¼çš„æ˜¯[[#useReducer]]å¯åšåˆ°
> [!note] å¸¸è§é—®é¢˜
> 1. ä½ ä»¥ä¸ºæ²¡æœ‰ä½¿ç”¨æ•°æ®æµä¸­çš„å€¼ï¼Œä½†å…¶å®ä½¿ç”¨äº†ã€‚ä½ è¦ä½¿ç”¨ç­–ç•¥ï¼ˆä¸»è¦æ˜¯useReducer å’Œ useCallbackï¼‰æ¥ç§»é™¤è¿™äº›effectä¾èµ–ã€‚

> [!note] åº”ç”¨
> 

1.  ä»…å½“ç»„ä»¶æ›´æ–°æ—¶æ‰§è¡Œå‰¯ä½œç”¨
```js
const Toggler = ({ toggle, onToggle }) => {
// æ·»åŠ â€œå·²æŒ‚è½½â€çš„æ ‡è¯†
  const didMount = React.useRef(false);
// åœ¨ä»»æ„ä¸€ä¸ªå‰¯ä½œç”¨ä¸­è¯»å–refå€¼ï¼Œå¦‚æœæ˜¯falseå°±å–åï¼Œå¦‚æœæ˜¯trueå°±æ‰§è¡Œå‰¯ä½œç”¨
  React.useEffect(() => {
    if (didMount.current) {
      console.log('I run only if toggle changes.');
    } else {
      didMount.current = true;
    }
  }, [toggle]);

  return (
    <div>
      <button type="button" onClick={onToggle}>
        Toggle
      </button>

      {toggle && <div>Hello React</div>}
    </div>
  );
};
```
2. ä»…å½“ä¾èµ–æ”¹å˜æ—¶æ‰§è¡Œä¸€æ¬¡å‰¯ä½œç”¨
```js
const Toggler = ({ toggle, onToggle }) => {
  // æ·»åŠ å·²â€œæ‰§è¡Œä¸€æ¬¡â€çš„æ ‡è¯†
  const calledOnce = React.useRef(false);

  React.useEffect(() => {
    if (calledOnce.current) {
      return;
    }

    if (toggle === false) {
      console.log('I run only once if toggle is false.');

      calledOnce.current = true;
    }
  }, [toggle]);

  return (
    <div>
      <button type="button" onClick={onToggle}>
        Toggle
      </button>

      {toggle && <div>Hello React</div>}
    </div>
  );
};
```
> [!note] ç›¸å…³
> [useEffect å®Œæ•´æŒ‡å— â€” Overreacted](https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/) 
> [ä½ å¯èƒ½ä¸éœ€è¦ Effect â€“ React](https://zh-hans.react.dev/learn/you-might-not-need-an-effect) 
## ä½¿ç”¨
### ä¸éœ€è¦
ã€5ç§ã€‚ä¸æ¸²æŸ“æ— å…³çš„ä¸åº”æ”¾å…¥ effectã€‘
ä½•æ—¶éœ€è¦ï¼šè¯¥å‰¯ä½œç”¨ä¸**ç»„ä»¶å±•ç¤º**ç›¸å…³
	1. ç»„ä»¶å±•ç¤ºæ—¶éœ€è¦focusã€å‘é€è¯·æ±‚
ä½•æ—¶ä¸éœ€è¦
	1. äº‹ä»¶å›è°ƒä¿®æ”¹äº†state/çˆ¶ç»„ä»¶ä¿®æ”¹äº†propsï¼Œåˆ©ç”¨è¯¥state/propsä¿®æ”¹æ‰§è¡Œä¸€äº›æ“ä½œ
		1. å¼¹å‡ºæç¤º
		2. å‘é€è¯·æ±‚
			1. åˆ·æ–°é¡µé¢ä¼šå¯¼è‡´å‘é€è¯·æ±‚ã€å¼¹å‡ºæç¤º
		3. æ›´æ–°å¦ä¸€ä¸ªstate
			1. æ¯æ¬¡æ›´æ–°éƒ½ä¼šå¯¼è‡´ä¸€æ¬¡ä¸å¿…è¦çš„é‡æ¸²æŸ“ã€‚å¦‚æœæ˜¯é“¾å¼æ›´æ–°stateï¼Œä¼šå¤šå¾ˆå¤šæ¬¡é‡æ¸²æŸ“ã€‚
		4. æ›´æ–°å¤šä¸ªstateï¼šæ”¾åœ¨ä¸€ä¸ªå‡½æ•°ä¸­
		5. é‡ç½®æ‰€æœ‰stateï¼šä¼ å…¥key
		6. propså˜åŒ–æ—¶é‡ç½®éƒ¨åˆ†state
	2. åªåœ¨åº”ç”¨æŒ‚è½½æ—¶æ‰§è¡Œçš„é€»è¾‘
		1. åœ¨å¼€å‘ç¯å¢ƒä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œè™½ç„¶åœ¨ç”Ÿäº§ä¸ä¼šï¼Œä½†åœ¨æ‰€æœ‰ç»„ä»¶ä½¿ç”¨ç›¸åŒçš„é€»è¾‘æ›´å®¹æ˜“ç§»åŠ¨ã€å¤ç”¨[^7] 

#### é¡¹ç›®åˆå§‹åŒ–çš„ç›¸å…³é€»è¾‘
ä¸è¦æŠŠä»…åœ¨é¡¹ç›®åˆå§‹åŒ–æ—¶æ‰§è¡Œä¸€æ¬¡çš„é€»è¾‘è¿™æ ·å®šä¹‰ï¼Œå› ä¸ºé¡µé¢åˆ·æ–°ä¹Ÿä¼šå¯¼è‡´æ‰§è¡Œå¤šæ¬¡
```js
function App() {
  // ğŸ”´ ç¦æ­¢ï¼šæŠŠåªéœ€è¦æ‰§è¡Œä¸€æ¬¡çš„é€»è¾‘ç›´æ¥æ”¾åœ¨ Effect ä¸­
  useEffect(() => {
    loadDataFromLocalStorage();
    checkAuthToken();
  }, []);
  // ...
}
```
å¤–éƒ¨æ·»åŠ ä¸€ä¸ªflagï¼Œæˆ–è€…ä½¿ç”¨useRef
```js
let didInit = false;

function App() {
  useEffect(() => {
    if (!didInit) {
      didInit = true;
      // âœ… åªåœ¨æ•´ä¸ªåº”ç”¨ç¬¬ä¸€æ¬¡åŠ è½½æ—¶æ‰§è¡Œä¸€æ¬¡
      loadDataFromLocalStorage();
      checkAuthToken();
    }
  }, []);
  // ...
}
```

#### props å˜åŒ–æ—¶é‡ç½® state
##### é‡ç½®æ‰€æœ‰
å°†å¯èƒ½å˜åŒ–çš„propså€¼ä½œä¸ºç»„ä»¶è°ƒç”¨æ—¶çš„keyå±æ€§å€¼å³å¯ã€‚å˜åŒ–æ—¶reactè®¤ä¸ºæ˜¯ä¸åŒçš„ç»„ä»¶ã€‚
##### é‡ç½®éƒ¨åˆ†
ä¸è¦ä¾èµ– props æ›´æ–°æŸä¸ª stateã€‚é€šè¿‡æ–°å¢ä¸€ä¸ª state ä¿å­˜ props æ—§å€¼ï¼Œå¯¹æ¯”åæ‰§è¡Œ state æ›´æ–°é€»è¾‘ã€‚
é—®é¢˜å†™æ³•ï¼š
```js
function List({ items }) {
  const [isReverse, setIsReverse] = useState(false);
  const [selection, setSelection] = useState(null);

  // ğŸ”´ é¿å…ï¼šå½“ prop å˜åŒ–æ—¶ï¼Œåœ¨ Effect ä¸­è°ƒæ•´ state
  useEffect(() => {
    setSelection(null);
  }, [items]);
  // ...
}
// æ¯æ¬¡itemsæ”¹å˜ï¼Œå…ˆç”¨selectionæ—§å€¼æ¸²æŸ“ä¸€éï¼Œå†æ›´æ–°DOMã€æ‰§è¡Œeffectï¼Œæœ€åå†æ¸²æŸ“ä¸€é
```
æ”¹è‰¯å†™æ³•ï¼š
```js
function List({ items }) {
  const [isReverse, setIsReverse] = useState(false);
  const [selection, setSelection] = useState(null);

  // åœ¨æ¸²æŸ“æœŸé—´è°ƒæ•´ stateï¼Œè€Œä¸æ˜¯ä½¿ç”¨effect
  const [prevItems, setPrevItems] = useState(items);
  if (items !== prevItems) {
    setPrevItems(items);
    setSelection(null);
  }
  // ...
}
```

#### æ ¹æ®props/stateæ›´æ–°state
ä¸è¦åœ¨å‰¯ä½œç”¨ä¸­è®¡ç®—ï¼Œè€Œæ˜¯åœ¨æ¸²æŸ“ä¸­è®¡ç®—

#### stateæ”¹å˜å¼•èµ·æ“ä½œ
æŸä¸ªstateçš„æ”¹å˜ä¼šå¼•èµ·å…¶ä»–æ“ä½œï¼ˆæç¤ºï¼‰ï¼Œæœ‰å¤šä¸ªå›è°ƒä¸­éœ€è¦ä¿®æ”¹è¯¥state
	1. é”™è¯¯æ–¹æ¡ˆï¼šå°†è¯¥ state ä½œä¸ºä¾èµ–ï¼Œè¯¥æ“ä½œä½œä¸ºå‰¯ä½œç”¨ã€‚å› ä¸º*æ¯æ¬¡é¡µé¢åˆ·æ–°éƒ½ä¼šè§¦å‘*è¯¥æ“ä½œï¼
	2. åº”è¯¥æå–å…¬å…±é€»è¾‘ï¼Œå°†ä¿®æ”¹ state ä¸å‰¯ä½œç”¨æ”¾åœ¨äº‹ä»¶å›è°ƒå‡½æ•°ä¸­
```js
function ProductPage({ product, addToCart }) {
  // âœ… éå¸¸å¥½ï¼šäº‹ä»¶ç‰¹å®šçš„é€»è¾‘åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­å¤„ç†
  function buyProduct() {
    addToCart(product);
    showNotification(`å·²æ·»åŠ  ${product.name} è¿›è´­ç‰©è½¦ï¼`);
  }

  function handleBuyClick() {
    buyProduct();
  }

  function handleCheckoutClick() {
    buyProduct();
    navigateTo('/checkout');
  }
  // ...
}
```
#### äº‹ä»¶å¼•èµ·çš„ç½‘ç»œè¯·æ±‚
äº‹ä»¶å¼•èµ·çš„[[ç½‘ç»œè¯·æ±‚]]åº”è¯¥æ”¾åœ¨äº‹ä»¶å›è°ƒä¸­ï¼Œ
```js
function Form() {
  const [firstName, setFirstName] = useState('');
  const [lastName, setLastName] = useState('');

  // âœ… éå¸¸å¥½ï¼šè¿™ä¸ªé€»è¾‘åº”è¯¥åœ¨ç»„ä»¶æ˜¾ç¤ºæ—¶æ‰§è¡Œ
  useEffect(() => {
    post('/analytics/event', { eventName: 'visit_form' });
  }, []);

  // ğŸ”´ é¿å…ï¼šåœ¨ Effect ä¸­å¤„ç†å±äºäº‹ä»¶ç‰¹å®šçš„é€»è¾‘
  const [jsonToSubmit, setJsonToSubmit] = useState(null);
  useEffect(() => {
    if (jsonToSubmit !== null) {
      post('/api/register', jsonToSubmit);
    }
  }, [jsonToSubmit]);

  function handleSubmit(e) {
    e.preventDefault();
    setJsonToSubmit({ firstName, lastName });
  }
  // ...
}
```
## ä½¿ç”¨
### åœ¨å†…éƒ¨å®šä¹‰ã€è°ƒç”¨å‰¯ä½œç”¨
å¦‚æœåœ¨å¤–éƒ¨å®šä¹‰å‰¯ä½œç”¨ï¼Œåˆ™éš¾ä»¥åˆ¤æ–­è¯¥å‰¯ä½œç”¨ä¾èµ–äº†å“ªäº›state/props
### å‰¯ä½œç”¨å‡½æ•°
ä¸è¦ä½¿ç”¨ async å‡½æ•°ï¼Œå› ä¸º react è¦æ±‚å‰¯ä½œç”¨å‡½æ•°çš„è¿”å›å€¼æ˜¯å‡½æ•°æˆ– undefinedï¼Œè€Œä¸æ˜¯ promise å¯¹è±¡ã€async å‡½æ•°ä¼šè¿”å› promise å¯¹è±¡ã€‘
# useInsertionEffect
DOMå˜åŠ¨å‰è§¦å‘
# useLayoutEffect
æ¸²æŸ“å‰åŒæ­¥æ‰§è¡Œçš„å‰¯ä½œç”¨
ç»„ä»¶ä» state å˜åŒ–åˆ°æ¸²æŸ“ï¼Œå¤§æ¦‚å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥
	1. **æ”¹å˜ state**ï¼Œè§¦å‘æ›´æ–° state å˜é‡çš„æ–¹æ³•ï¼Œå¾—åˆ°**æ–° Virtual DOM** 
	2. React æ ¹æ®ç»„ä»¶è¿”å›çš„ vDOM è¿›è¡Œ **diff å¯¹æ¯”**ï¼Œå¾—åˆ°éœ€è¦æ›´æ–°çš„å†…å®¹
	3. å°† diff ç»“æœäº¤ç»™æ¸²æŸ“çº¿ç¨‹å¤„ç†ï¼Œ**ç»˜åˆ¶åˆ°æµè§ˆå™¨ä¸Š** 
useEffect 
	1. åœ¨ç¬¬ 3 æ­¥ä¹‹åæ‰§è¡Œ
	2. å¼‚æ­¥æ‰§è¡Œï¼Œæ‰€è°“å¼‚æ­¥å°±æ˜¯è¢« requestIdleCallback å°è£…ï¼Œåªåœ¨æµè§ˆå™¨ç©ºé—²æ—¶å€™æ‰ä¼šæ‰§è¡Œï¼Œä¿è¯äº†ä¸ä¼šé˜»å¡æµè§ˆå™¨çš„æ¸²æŸ“è¿‡ç¨‹ã€‚
useLayoutEffect
	1. åœ¨ç¬¬äºŒæ­¥ï¼ˆdiff å‡ºå·®å¼‚ï¼‰ä¹‹åï¼Œç¬¬ä¸‰æ­¥ï¼ˆåº”ç”¨æ›´æ–°åˆ°æµè§ˆå™¨é¡µé¢ï¼‰ä¹‹å‰æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æ¸²æŸ“ä¹‹å‰åŒæ­¥æ‰§è¡Œçš„ï¼Œæ‰€ä»¥ä¼šç­‰å®ƒæ‰§è¡Œå®Œå†æ¸²æŸ“é¡µé¢åˆ°æµè§ˆå™¨ä¸Šã€‚
	2. åœ¨æµè§ˆå™¨layoutä¹‹åï¼Œpaintingä¹‹å‰
ä¸useEffectçš„åŒºåˆ«
		1. åœ¨*æ¸²æŸ“å‰åŒæ­¥*æ‰§è¡Œï¼Œè€Œä¸æ˜¯æ¸²æŸ“åï¼Œä¼š*é˜»å¡ DOM æ¸²æŸ“*ã€‚
		3. æœåŠ¡ç«¯æ¸²æŸ“ï¼ˆ[[SSR]]ï¼‰æ—¶useLayoutEffect æ— æ•ˆï¼Œä½¿ç”¨ useEffect
åœºæ™¯ï¼šæ“ä½œ [[DOM]]/ä¸æƒ³å‡ºç° **å†…å®¹é—ªçƒ** 
# useContextï¼šä¼ é€’
åŠŸèƒ½ï¼šåœ¨å‡½æ•°ç»„ä»¶ä¸­*è¯»å–*ä¸€ä¸ªç»„ä»¶æ ‘ä¸­çš„[[context]]ã€‚
	1. åœ¨æŸä¸ªç»„ä»¶ä¸­ä¿®æ”¹å…¨å±€ç”¨åˆ°çš„æ•°æ®
# useMemoï¼šç¼“å­˜
ä¼ å‚ï¼šåŒ[[å‡½æ•°ç»„ä»¶#useEffect]]ã€‚
åŠŸèƒ½ï¼šå½“ä¾èµ–æ”¹å˜æ—¶ï¼Œé‡æ–°æ‰§è¡Œä¸€æ¬¡**å¤§é‡è®¡ç®—**å¹¶è¿”å›ä¸€ä¸ªæ–°å€¼
> [!note] åº”ç”¨
> 

## é¿å…æ— æ„ä¹‰çš„é‡æ–°è®¡ç®—
ä¸€ä¸ªå€¼çš„è®¡ç®—è¿‡ç¨‹è¾ƒå¤æ‚ï¼Œå‚æ•°æ²¡æœ‰æ›´æ–°æ—¶ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®—
	1. totoListå·²å®Œæˆã€æœªå®Œæˆã€å…¨éƒ¨çš„ç­›é€‰
## é¿å…é‡æ¸²æŸ“
1. ç»„ä»¶çš„*æ¸²æŸ“å¼€é”€è¾ƒå¤§*æ—¶
	1. å®šä¹‰æ—¶ä½¿ç”¨react.memoåŒ…è£¹ç»„ä»¶
	2. è°ƒç”¨æ—¶ä½¿ç”¨useMemoåŒ…è£¹å¼•ç”¨ç±»å‹çš„å±æ€§å€¼[^4] 
åŸå› ï¼šå½“ä¸€ä¸ªç»„ä»¶æ›´æ–°æ—¶ï¼Œå³ä½¿å­ç»„ä»¶æ¥æ”¶çš„propsæ²¡æœ‰æ›´æ–°ä¹Ÿä¼šé‡æ–°æ¸²æŸ“ã€‚
é—®é¢˜ï¼šå¦‚æœä¼ é€’çš„å±æ€§æ˜¯å¼•ç”¨ç±»å‹æ•°æ®ï¼Œä»å†…å®¹ä¸Šçœ‹ç¡®å®æ²¡å˜ï¼Œä½†çˆ¶ç»„ä»¶é‡æ–°æ‰§è¡Œå°±æ˜¯å£°æ˜äº†ä¸€ä¸ª*æ–°å€¼*ï¼Œæ‰€ä»¥å­ç»„ä»¶ä»ä¼šæ›´æ–°
	æ–¹æ¡ˆï¼šå°†ä¼ é€’çš„å¼•ç”¨ç±»å‹æ•°æ®ã€å‡½æ•°æˆ–å…¶ä»–å¼•ç”¨ç±»å‹å€¼ã€‘ä½¿ç”¨useMemoï¼Œä¿ç•™å¼•ç”¨å€¼ã€‚
```js
import React, { memo, useState } from 'react';

// å­ç»„ä»¶
const ChildComp = (props:{info:{name, age}}) => {
  console.log('ChildComp...',name,age);
  return (<div>ChildComp...</div>);

};

const MemoChildComp = memo(ChildComp);

// çˆ¶ç»„ä»¶
const Parent = () => {
  const [count, setCount] = useState(0);
  const [name] = useState('jack');
  const [age] = useState(11);
  // æ›´æ–°å‰ï¼šä¼šä¸€ç›´é‡æ–°æ¸²æŸ“
  const info = { name, age };
  // æ›´æ–°åï¼šå¼•ç”¨ç±»å‹ä¸ä¼šå†å¯¼è‡´é‡æ–°æ¸²æŸ“
  const info = useMemo(() => ({ name, age }), [name, age]);
  return (
    <div className="App">
      <div>hello world {count}</div>
      <button onClick={() => { setCount(count => count + 1); }}>ç‚¹å‡»å¢åŠ </button>
      <MemoChildComp info={info}/>
    </div>
  );
};

export default Parent;

```

## ç¼“å­˜å¦ä¸€ä¸ªhookçš„ä¾èµ–
```js
function Dropdown({ allItems, text }) {
  // ä½œä¸ºä¾èµ–ï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½ä¼šé‡æ–°ç”Ÿæˆï¼Œå¯¼è‡´ä¸‹æ–¹çš„visibleItemsçš„ç¼“å­˜å¤±å»ä½œç”¨
  const searchOptions = { matchMode: 'whole-word', text };
  // ä½œä¸ºä¾èµ–çš„å¯¹è±¡å­—é¢é‡ï¼Œåº”ä½¿ç”¨useMemoåˆ›å»º
  const searchOptions = useMemo(() => {
    return { matchMode: 'whole-word', text };
  }, [text]);
  
  const visibleItems = useMemo(() => {
    return searchItems(allItems, searchOptions);
  }, [allItems, searchOptions]); // ğŸš© Caution: Dependency on an object created in the component body
  // ...
  }
```

# useCallbackï¼šç¼“å­˜
ä¼ å‚ï¼šåŒ[[å‡½æ•°ç»„ä»¶#useEffect]]ã€‚
åŠŸèƒ½ï¼šè¿”å›ä¸€ä¸ªå‡½æ•°å®šä¹‰ã€‚å½“ä¾èµ–æ”¹å˜æ—¶ï¼Œè¿”å›ä¸€ä¸ªæ–°å‡½æ•°
	å³ä½¿å¤šæ¬¡æ›´æ–°ï¼Œä¹Ÿèƒ½æ‹¿åˆ°ç›¸åŒçš„å‡½æ•°
```js
import { useCallback } from 'react';

export default function ProductPage({ productId, referrer, theme }) {
  // ç¼“å­˜å‡½æ•°å£°æ˜
  const handleSubmit = useCallback((orderDetails) => {
    post('/product/' + productId + '/buy', {
      referrer,
      orderDetails,
    });
  }, [productId, referrer]);
  return ()
  }
```
## é¿å…é‡æ¸²æŸ“
å½“å­ç»„ä»¶ä½¿ç”¨äº†react.memoä¸”å­˜åœ¨æŸä¸ªå±æ€§ä¸ºå‡½æ•°æ—¶ï¼Œä½¿ç”¨useCallbackï¼ˆå‡å°‘æ¸²æŸ“æ¬¡æ•°ï¼‰
	é—®é¢˜ï¼šçˆ¶ç»„ä»¶å†…é‡æ–°æ¸²æŸ“æ—¶ï¼Œé‡æ–°å£°æ˜äº†ä¸€ä¸ªä¸åŒçš„å‡½æ•°ã€‚æ‰€ä»¥**å­ç»„ä»¶è®¤ä¸ºpropsæ”¹å˜äº†**ã€‚
	æ–¹æ¡ˆï¼šå°†éœ€è¦ä¸‹ä¼ çš„å›è°ƒä½¿ç”¨useCallbackåŒ…è£¹ã€ä»…å¤„ç†ä¸‹ä¼ çš„å‡½æ•°ã€‘
## ä½¿ç”¨æ—§å€¼æ›´æ–°çŠ¶æ€
```js
function TodoList() {
  const [todos, setTodos] = useState([]);
  // stateçš„æ›´æ–°ä¾èµ–äºä¹‹å‰çš„state
  const handleAddTodo = useCallback((text) => {
    // æ¯æ¬¡todosæ›´æ–°ï¼Œéƒ½ä¼šä¿å­˜ä¸‹æ¥
    const newTodo = { id: nextId++, text };
    setTodos([...todos, newTodo]);
  }, [todos]);
```
ä¹Ÿå¯ä»¥é€šè¿‡æ›´æ–°å‡½æ•°ï¼Œå»ä½¿ç”¨ä¸Šæ¬¡çš„å€¼
```js
function TodoList() {
  const [todos, setTodos] = useState([]);

  const handleAddTodo = useCallback((text) => {
    const newTodo = { id: nextId++, text };
    setTodos(todos => [...todos, newTodo]);
  }, []); // âœ… No need for the todos dependency
```
## é¿å…å‰¯ä½œç”¨é‡å¤æ‰§è¡Œ/å‰¯ä½œç”¨çš„ä¾èµ–æ˜¯å‡½æ•°æ—¶
é—®é¢˜ï¼šå¦‚æœå‡½æ•°å£°æ˜æ”¾åœ¨å¤–é¢ï¼Œåœ¨å‰¯ä½œç”¨å†…è°ƒç”¨è¯¥å‡½æ•°ï¼Œå¯èƒ½å¯¼è‡´å¤šæ¬¡è°ƒç”¨
```js
function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  function createOptions() {
    return {
      serverUrl: 'https://localhost:1234',
      roomId: roomId
    };
  }
  // åˆ›å»ºä¸€ä¸ªæ–°çš„æˆ¿é—´è¿æ¥
  useEffect(() => {
    const options = createOptions();
    const connection = createConnection();
    connection.connect();
    // ...
```
createOptionsæ¯æ¬¡çš„è¿”å›å€¼ä¸åŒï¼Œæ‰€ä»¥æ¯æ¬¡æ¸²æŸ“éƒ½å¿…é¡»è·å¾—æœ€æ–°çš„å‡½æ•°
æ–¹æ¡ˆ
	1. å°†createOptionsæ·»åŠ åˆ°ä¾èµ–åˆ—è¡¨ï¼šæ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºæ¯æ¬¡æ›´æ–°éƒ½ä¼šåˆ›å»ºï¼Œæ‰€ä»¥å‰¯ä½œç”¨æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œ
	2. å°†createOptionsç¼“å­˜åï¼Œæ·»åŠ åˆ°ä¾èµ–åˆ—è¡¨ï¼šå¯ä¿è¯ä»…åœ¨å‡½æ•°æ›´æ–°æ—¶ï¼Œå‰¯ä½œç”¨é‡æ–°æ‰§è¡Œã€‚
	3. ä¸ä½¿ç”¨å‡½æ•°ä¾èµ–ï¼Œå°†éœ€è¦ä¾èµ–state/propsæ›´æ–°çš„å‡½æ•°å£°æ˜æ”¾åœ¨å‰¯ä½œç”¨å†…éƒ¨
```js
function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  useEffect(() => {
    function createOptions() { // âœ… No need for useCallback or function dependencies!
      return {
        serverUrl: 'https://localhost:1234',
        roomId: roomId
      };
    }

    const options = createOptions();
    const connection = createConnection();
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]); // âœ… Only changes when roomId changes
  // ...
```
## ä¼˜åŒ–è‡ªå®šä¹‰Hook
å°†ä»»æ„å‡½æ•°å£°æ˜æ”¾åœ¨useCallbackä¸­
```js
function useRouter() {
  const { dispatch } = useContext(RouterStateContext);

  const navigate = useCallback((url) => {
    dispatch({ type: 'navigate', url });
  }, [dispatch]);

  const goBack = useCallback(() => {
    dispatch({ type: 'back' });
  }, [dispatch]);

  return {
    navigate,
    goBack,
  };
}
```
# useRefï¼šä¿å­˜ä¸å˜å€¼/DOM å…ƒç´ ã€ä¼ é€’
ä½œç”¨
	1. ä¿å­˜é¡µé¢æ¸²æŸ“æ— å…³çš„æ•°æ®ï¼Œåœ¨ç»„ä»¶çš„æ‰§è¡Œå‘¨æœŸä¸­å§‹ç»ˆä¸å˜ã€‚ä¸€èˆ¬æ˜¯ DOMã€‚
		1. å› ä¸ºå‡½æ•°ç»„ä»¶å†…æ¯æ¬¡é‡æ–°æ‰§è¡Œï¼Œæ•°æ®éƒ½ç›¸å½“äºé‡æ–°å£°æ˜
	2. çˆ¶ç»„ä»¶è·å–å­å‡½æ•°ç»„ä»¶æä¾›çš„**å…ƒç´ æˆ–éƒ¨åˆ† API**
ç‰¹æ€§
	1. useRefåœ¨åç»­æ¸²æŸ“ä¸­å§‹ç»ˆè¿”å›ç›¸åŒå¯¹è±¡ã€‚å¯é€šè¿‡æ‰‹åŠ¨ä¿®æ”¹currentå±æ€§å­˜å‚¨æ•°æ®
		1. åœ¨å¤šæ¬¡æ¸²æŸ“ä¸­æ‹¿åˆ°ç›¸åŒçš„å€¼
	2. æ”¹å˜refä¸ä¼šè§¦å‘æ›´æ–°
	3. ä¸è¦åœ¨**æ¸²æŸ“æœŸé—´**è¯»å†™[^8]ref.current
	4. æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šè°ƒç”¨ï¼Œä½†reactå§‹ç»ˆä¿å­˜åˆå§‹å€¼
		1. ä¸è¦ä½¿ç”¨å‡½æ•°è°ƒç”¨å»ä½œä¸ºåˆå§‹å€¼ï¼Œå¦åˆ™æ¯æ¬¡éƒ½ä¼šè¿›è¡Œæ— æ„ä¹‰çš„è®¡ç®—ï¼š`const playerRef = useRef(new VideoPlayer());` 
		2. ä½¿ç”¨è¯­å¥è¿›è¡Œå¤æ‚çš„åˆå§‹åŒ–ï¼š`const playerRef = useRef(null); if (playerRef.current === null) {playerRef.current = newVideoPlayer();}` 

> [!abstract] åº”ç”¨
> 1. ä½¿å‰¯ä½œç”¨ä»…åœ¨æ›´æ–°æ—¶æ‰§è¡Œ
> 2. å®šæ—¶å™¨

# useImperativeHandleï¼šä¼ é€’
ç›®çš„ï¼šçˆ¶ç»„ä»¶è·å–å­å‡½æ•°ç»„ä»¶æä¾›çš„**éƒ¨åˆ†å€¼**[^6] 
```js
import {  useRef,forwardRef,MutableRefObject,useImperativeHandle,Ref} from "react";

//åªæš´éœ²valueã€getTypeã€focusç»™çˆ¶çº§
const InputEl = forwardRef((props, ref)=>{
    const inputEl = useRef();
    useImperativeHandle(ref, ()=>({//p1ï¼šæš´éœ²å“ªä¸ªrefï¼›p2ï¼šæš´éœ²ä»€ä¹ˆ
		// refåªæ˜¯ç”¨äºä¼ é€’çš„æ ‡è¯†ï¼Œä¼ å€¼éœ€è¦ä½¿ç”¨ç»‘å®šçš„å…ƒç´ 
        value: inputEl.current.value,
        getType: () => inputEl.type,
        focus: () => inputEl.focus()
    }));
	// ä¹Ÿéœ€è¦ç»‘å®šDOMå…ƒç´ 
    return(
        <input ref={inputEl} type="text" {...props}/>
    )
})
//æš´éœ²inputå…ƒç´ ç»™çˆ¶çº§
const InputEl = forwardRef((props: {}, ref: Ref<any>): JSX.Element=>{
    return(
        <input ref={ref} type="text" {...props}/>
    )
});

//çˆ¶çº§
function InputWithFocusButton() {
    const inputEl: MutableRefObject<any> = useRef(null);

    function onButtonClick() {
        console.log('å­ç»„ä»¶inputçš„å¯¹è±¡:', inputEl.current);
        inputEl.current.focus();
    };
    return (
        <>
            <InputEl ref={inputEl} />
            <button onClick={onButtonClick}>Focus the input</button>
        </>
    );
}

```
å¯¹æ¯”ï¼šforwardRefç»“åˆrefæ‹¿åˆ°å­å‡½æ•°ç»„ä»¶ä¸­çš„**å…ƒç´ **ï¼Œå†ä½¿ç”¨useImperativeValueå¯æ‹¿åˆ°**éƒ¨åˆ†å€¼**ã€‚
# useDebugValueï¼šè°ƒè¯•
åŠŸèƒ½ï¼šä¸ºè‡ªå®šä¹‰hookæ·»åŠ æ ‡ç­¾
useDebugValue(value, format?)
	1. valueï¼šæƒ³åœ¨ React *å¼€å‘å·¥å…·ä¸­æ˜¾ç¤º*çš„å€¼ã€‚å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ã€‚
	2. å¯é€‰ formatï¼šæ ¼å¼åŒ–å‡½æ•°ã€‚å½“ç»„ä»¶è¢«æ£€æŸ¥æ—¶ï¼ŒReact å¼€å‘å·¥å…·å°†ç”¨ value ä½œä¸ºå‚æ•°æ¥è°ƒç”¨æ ¼å¼åŒ–å‡½æ•°ï¼Œç„¶åæ˜¾ç¤ºè¿”å›çš„æ ¼å¼åŒ–å€¼ï¼ˆå¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼‰ã€‚ä¸ä¼ åˆ™ä¼šæ˜¾ç¤º valueã€‚
	3. æ²¡æœ‰è¿”å›å€¼ã€‚
é€‚ç”¨ï¼šä½œä¸º*å…±äº«åº“*ä¸€éƒ¨åˆ†ã€å…·æœ‰*å¤æ‚çš„å†…éƒ¨æ•°æ®ç»“æ„å¹¶ä¸”éš¾ä»¥æ£€æŸ¥*çš„è‡ªå®šä¹‰ Hook 
# useSyncExternalStore
åŠŸèƒ½ï¼šè®¢é˜…ä¸€ä¸ªå¤–ç•Œstore
å½¢å¼ï¼š `const snapshot = useSyncExternalStore(subscribe, getSnapshot, getServerSnapshot?)`
# useTransition
åŠŸèƒ½ï¼šä¸ä¼šé˜»å¡UIåœ°æ›´æ–°çŠ¶æ€
	1. å°†çŠ¶æ€çš„*æ›´æ–°*ï¼Œæ ‡è®°ä¸º*è¿‡æ¸¡* 
å½¢å¼ï¼š`const [isPending, startTransition] = useTransition()`
	1. ä¸éœ€è¦å‚æ•°
	2. è¿”å›å€¼
		1. æ˜¯å¦å­˜åœ¨å¾…è¿‡æ¸¡çš„çŠ¶æ€
		2. å°†*çŠ¶æ€æ›´æ–°*æ ‡è®°ä¸º*è½¬æ¢*çš„å‡½æ•°ã€‚
			1. å‚æ•°ï¼šé€šè¿‡è°ƒç”¨ state æ›´æ–°å‡½æ•°æ¥æ›´æ–° state çš„å‡½æ•°ï¼Œã€å®ƒä¼šæŠŠæ›´æ–°è¿‡ç¨‹å˜æˆè¿‡æ¸¡è¿‡ç¨‹ï¼Ÿã€‘
				1. ç«‹å³è°ƒç”¨ï¼ŒåŒæ­¥åœ°å°†å†…éƒ¨æ‰€æœ‰çš„çŠ¶æ€æ›´æ–°æ ‡è®°ä¸ºè½¬æ¢ã€‚éé˜»å¡ï¼Œå¹¶ä¸ä¼šå±•ç¤º loading æŒ‡æ ‡å™¨
å«ä¹‰ï¼šè¿‡æ¸¡
åœºæ™¯
	1. 
# è‡ªå®šä¹‰hook
```js
import React from 'react';
// å®šä¹‰æ£€æµ‹åœ¨çº¿çŠ¶æ€çš„hook
function useOffline() {
  const [isOffline, setIsOffline] = React.useState(false);

  function onOffline() {
    setIsOffline(true);
  }

  function onOnline() {
    setIsOffline(false);
  }

  React.useEffect(() => {
    window.addEventListener('offline', onOffline);
    window.addEventListener('online', onOnline);

    return () => {
      window.removeEventListener('offline', onOffline);
      window.removeEventListener('online', onOnline);
    };
  }, []);
// è¿”å›åœ¨çº¿çŠ¶æ€
  return isOffline;
}
// åœ¨æ•´ä¸ªåº”ç”¨å±‚çº§è°ƒç”¨
function App() {
  const isOffline = useOffline();

  if (isOffline) {
    return <div>Sorry, you are offline ...</div>;
  }

  return <div>You are online!</div>;
}

export default App;
```
## useAxios

# ä¸‰æ–¹ hooks

# æ¡ˆä¾‹
1. å€’è®¡æ—¶
```js
import React, { useState, useEffect, useRef } from "react";

export default function CountDown() {
  const maxTime = 60;
  const [countDownText, setCountDownText] = useState("è·å–éªŒè¯ç ");
  const [timerNum, setTimerNum] = useState(maxTime);
  const [boolCountDown, setBoolCountDown] = useState(false);
  const refCountDown = useRef(null);
  const handleClick = () => {
    if (!boolCountDown) {
      setBoolCountDown(true);
    }
  };

  refCountDown.current = () => {
  // ä¸ºä»€ä¹ˆåœ¨è¿™é‡Œè¯»å–çš„å°±æ˜¯æ›´æ–°åçš„å€¼
  // å› ä¸ºè¿™é‡Œæ¯æ¬¡é‡æ–°å£°æ˜äº†ä¸€ä¸ªå‡½æ•°ï¼Œå†…éƒ¨æ•è·åˆ°äº†æœ€æ–°çš„state
    if (timerNum > 0) {
      setTimerNum(timerNum - 1);
    } else {
      setTimerNum(maxTime);
      setBoolCountDown(false);
      setCountDownText("é‡æ–°è·å–");
    }
  };

  // const otherCountDown = () => {
  // ä¸ºä»€ä¹ˆåœ¨è¿™é‡Œè¯»å–çš„å°±ä¸€ç›´æ˜¯åˆå§‹å€¼
  // å› ä¸ºå®šæ—¶å™¨æ˜¯å¼‚æ­¥çš„ã€‚ç¬¬ä¸€æ¬¡æ‰§è¡Œeffectæ—¶è¿™é‡Œè¯»å–åˆ°timerNumæ˜¯60ï¼Œ
  //   console.log(timerNum, "timerNum");
  //   setTimerNum((timerNum) => timerNum - 1);
  // };

  useEffect(() => {
    if (boolCountDown) {
      const timer = setInterval(() => {
        // otherCountDown();
        refCountDown.current();
      }, 1000);
      return () => clearInterval(timer);
    }
  }, [boolCountDown]);

  return (
    <div>
      <button type="button" onClick={handleClick}>
        {boolCountDown ? `${timerNum}s` : countDownText}
      </button>
    </div>
  );
  
// åˆ†æéœ€æ±‚ï¼šç‚¹å‡»æ—¶ï¼šåˆ‡æ¢å±•ç¤ºå€’è®¡æ—¶æˆ–æ–‡æ¡ˆ
æ¯æ¬¡å€’è®¡æ—¶å‡1såï¼Œåˆ¤æ–­å€’è®¡æ—¶æ˜¯å¦æ˜¯0ã€‚å¦‚æœæ˜¯0ï¼Œé‡ç½®ç‚¹å‡»å¸ƒå°”ã€å½“å‰æ—¶é—´ã€‚å¦‚æœä¸æ˜¯0ï¼Œå‡1
```
1. [blissful-colden-5vmuw - CodeSandbox](https://codesandbox.io/s/blissful-colden-5vmuw)ï¼šç”¨å‡½æ•°ç»„ä»¶å®ç°ä¸€ä¸ªå®šæ—¶å™¨ã€‚

### é¢‘ç¹çš„ç½‘ç»œè¯·æ±‚
**ç«æ€æ¡ä»¶**ï¼šå¦‚æœç”¨æˆ·è¾“å…¥çš„inputå˜åŒ–è¾ƒå¿«ï¼Œé€šè¿‡å‰¯ä½œç”¨å¤šæ¬¡å‘é€çš„è¯·æ±‚ï¼Œå“åº”é¡ºåºå¯èƒ½ä¸æ€»æ˜¯ç¬¦åˆé¢„æœŸï¼Œæœ€ç»ˆå±•ç¤ºé”™è¯¯çš„ç»“æœã€‚
```js
  useEffect(() => {
    // ğŸ”´ é¿å…ï¼šæ²¡æœ‰æ¸…é™¤é€»è¾‘çš„è·å–æ•°æ®
    fetchResults(query, page).then(json => {
      setResults(json);
    });
  }, [query, page]);
```
å¿½ç•¥ä¸Šæ¬¡çš„è¯·æ±‚ç»“æœ
```js
function SearchResults({ query }) {
  const [results, setResults] = useState([]);
  const [page, setPage] = useState(1);
  useEffect(() => {
    let ignore = false;
    fetchResults(query, page).then(json => {
    // å¦‚æœä¸‹æ¬¡æ¸²æŸ“å‘ç”Ÿäº†ï¼Œåˆ™æ­¤æ—¶ä¸è¿›è¡Œæ“ä½œ
      if (!ignore) {
        setResults(json);
      }
    });
    return () => {
      ignore = true;
    };
  }, [query, page]);

  function handleNextPageClick() {
    setPage(page + 1);
  }
```
æˆ–è€…å°è£…ä¸ºä¸€ä¸ªHookï¼Œæ–¹ä¾¿ç»´æŠ¤
```js
  function useData(url) {
  const [data, setData] = useState(null);
  useEffect(() => {
    let ignore = false;
    fetch(url)
      .then(response => response.json())
      .then(json => {
        if (!ignore) {
          setData(json);
        }
      });
    return () => {
      ignore = true;
    };
  }, [url]);
  return data;
}
}
function SearchResults({ query }) {
  const [page, setPage] = useState(1);
  const params = new URLSearchParams({ query, page });
  const results = useData(`/api/search?${params}`);

  function handleNextPageClick() {
    setPage(page + 1);
  }
  // ...
}
```
å½“ä¸€æ¬¡è€—æ—¶çš„[[å‰¯ä½œç”¨]]è¿˜æ²¡ç»“æŸï¼Œç¬¬äºŒæ¬¡æ¸²æŸ“å°±å¼€å§‹äº†ã€‚å¯èƒ½å¯¼è‡´**ç«æ€æ¡ä»¶** 
å¯åˆ©ç”¨ return çš„ä¸‹æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œã€æ•è·ä¸Šæ¬¡å˜é‡çš„ç‰¹æ€§ï¼Œ**é¿å…ä¸Šæ¬¡çš„å‰¯ä½œç”¨ç”Ÿæ•ˆ** 

# æ€»ç»“
1. useMemoï¼šä¿å­˜**ä¼ å…¥å‡½æ•°çš„è¿”å›å€¼**ï¼Œé¿å…é‡æ–°ç”Ÿæˆ
	1. ç”¨äºç»„ä»¶ã€‚è¢«React.memoçš„ç»„ä»¶å¯é¿å…*å±æ€§æœªæ”¹å˜*æ—¶é‡æ–°æ¸²æŸ“
		1. å¦‚æœå±æ€§ä¼ é€’çš„å¼•ç”¨ç±»å‹ï¼Œå­ç»„ä»¶ä»ä¼šæ›´æ–°ã€‚
			1. ä½¿ç”¨useMemoä¿å­˜è¯¥å¼•ç”¨ç±»å‹å€¼ï¼š`const info = useMemo(() => ({ name, age }), [name, age]);`[^2] 
	2. ç”¨äºå€¼ã€‚éœ€è¦å¤§é‡è®¡ç®—è¿‡ç¨‹ï¼Œæˆ–å¾ˆå°‘æ”¹å˜çš„å€¼ã€‚
	3. å¦‚æœå‡½æ•°çš„è¿”å›å€¼æ˜¯å¦ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™ç±»ä¼¼useCallback
2. useCallbackï¼šä¿å­˜**ä¼ å…¥å‡½æ•°**ï¼Œé¿å…é‡æ–°ç”Ÿæˆ
	1. é¿å…æ¯æ¬¡å› ä¸ºçˆ¶ç»„ä»¶æ›´æ–°è€Œç”Ÿæˆæ–°çš„å‡½æ•°
		1. å‘å·²memoçš„å­ç»„ä»¶ä¼ é€’å›è°ƒ
3. useCallbackæ˜¯useMemoçš„å­é›†ï¼Œå› ä¸ºå‡½æ•°ä¹Ÿæ˜¯å€¼ã€‚å½“useMemoä¸­å›è°ƒçš„è¿”å›å€¼æ˜¯å‡½æ•°æ—¶ï¼Œç®€æ´å†™æ³•æ˜¯ä½¿ç”¨useCallbackã€‚
## å¯ä»¥å®ç°çš„åŠŸèƒ½
1. *çŠ¶æ€*åŠå…¶æ›´æ–°ï¼šuseState/useReducer
2. [[å‰¯ä½œç”¨]]ï¼šåŒæ­¥æˆ–å¼‚æ­¥ï¼šuseEffect/useLayoutEffect
3. é•¿æœŸä¿å­˜ä¸å˜çš„*å€¼*ï¼šuseRef
4. ä¿ç•™å¼•ç”¨ç±»å‹çš„å¼•ç”¨*å€¼*ï¼Œæ¡ä»¶æ›´æ–°
	1. useMemo
	2. useCallback
5. æ·±å±‚åŒå‘*ä¼ é€’æ•°æ®*ï¼šReact.createContextã€useContext
	1. æ·±å±‚ä¿®æ”¹é«˜å±‚æ•°æ®ï¼Œå†è¾å°„åˆ°å…¶å®ƒæ·±å±‚ç»„ä»¶
6. å‘çˆ¶ç»„ä»¶*ä¼ é€’å­ç»„ä»¶*[^5] ï¼šReact.forwardRefã€useRef
	1. æ•´ä¸ªå…ƒç´ ï¼šref
	2. éƒ¨åˆ†æ•°æ®ï¼šuseImperativeHandle
7. è¿Ÿå»¶*æ›´æ–°*ã€ç»„ä»¶çš„å±•ç¤ºä¾èµ–äºå¤§é‡æ•°æ®ã€‘
	1. React.Suspenseï¼šä½¿ç”¨æç¤ºç»„ä»¶ä»£æ›¿ç©ºç™½
		1. ä½¿ç”¨Suspenseç»„ä»¶çš„fallbackå®šä¹‰æç¤ºç»„ä»¶
	2. useDeferredValueï¼š
		1. ä½¿ç”¨æ—§UIä»£æ›¿ç©ºç™½
		2. UIæœªæ›´æ–°çš„å¤„ç†ï¼ˆæ–‡å­—ç°æš—ï¼‰
8. é¿å…*é‡æ¸²æŸ“* 
	1. React.memo

éœ€è¦è°ƒç”¨å‡½æ•°ç¡®å®šåˆå§‹å€¼æ—¶ï¼Œé¿å…é‡å¤
	1. useRef
	2. useReducer
# å®è·µ
## å®šä¹‰
1. å¯¼å‡ºç»„ä»¶å‰ä½¿ç”¨React.memoåŒ…è£¹ç»„ä»¶ã€ä»…å¯¹æ¯”åŸå§‹ç±»å‹æ•°æ®æ¯”è¾ƒå¥½ç”¨ï¼Œå¼•ç”¨ç±»å‹ã€‘

## è°ƒç”¨
1. ä½¿ç”¨useCallbackåŒ…è£¹éœ€è¦ä¸‹ä¼ çš„å›è°ƒ
2. ä½¿ç”¨useMemoåŒ…è£¹éœ€è¦ä¸‹ä¼ çš„éå‡½æ•°çš„å€¼

```dataviewjs

```


[^1]: è¢«ä¿å­˜åœ¨reactä¸­ï¼Œç­‰å¾…ä¸‹æ¬¡æ›´æ–°è¿‡ç¨‹ä¸­è°ƒç”¨
[^2]: ä»…å½“ç›®æ ‡å€¼æ”¹å˜æ—¶å†ç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„å¼•ç”¨å€¼
[^3]: åŸç”Ÿå…ƒç´ ï¼Œå¦‚inputï¼Œå¯ç›´æ¥é€šè¿‡ç»‘å®šrefå±æ€§è·å¾—è¯¥å…ƒç´ 
[^4]: å¯ä»ä¸¤ä¸ªæ–¹é¢é¿å…çˆ¶ç»„ä»¶æ›´æ–°çš„é‡æ¸²æŸ“ï¼šåŸºç¡€å€¼å’Œå¼•ç”¨å€¼
[^5]: å‰æï¼šä½¿ç”¨forwardRefä¸ºå‡½æ•°ç»„ä»¶æ·»åŠ refå±æ€§ã€‚å¯ä¼ é€’å­ç»„ä»¶çš„å…ƒç´ ã€æ•°æ®
[^6]: ä½¿ç”¨refï¼Œçˆ¶ç»„ä»¶å¯è·å¾—æ•´ä¸ªDOMå…ƒç´ ï¼Œä½¿ç”¨è¯¥APIï¼Œå¯è·å¾—éƒ¨åˆ†ã€‚
[^7]: è®¤è¯é€»è¾‘è°ƒç”¨ä¸¤æ¬¡ä¼šå¯¼è‡´tokenå¤±æ•ˆ
[^8]: æ¸²æŸ“æœŸé—´è¯»ï¼šåœ¨returnä¸­è¯»å–ref.currentã€‚æ¸²æŸ“æœŸé—´å†™ï¼šåœ¨å‡½æ•°ç»„ä»¶çš„é¡¶å±‚ä½œç”¨åŸŸä¸­ä¿®æ”¹ref.currentã€‚