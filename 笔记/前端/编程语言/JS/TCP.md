[[传输层]]协议
# 建立TCP连接的过程
1. 三次握手 [[握手.png]] 
	1. 含义：建立TCP连接时，客户端与服务器总共发送3个包。
	2. 目的：确认双方都具有发送能力和接收能力。
	3. 过程
		1. 客户端发送SYN包（seq=x），进入SYN_SEND状态。等待服务器确认[^1] 
		2. 服务端收到SYN包（ack=x+1），必须确认并发送一个SYN包(seq=y)，即SYN+ACK包。进入SYN_RECV状态[^2] 
		3. 客户端收到SYN+ACK包，向服务器发送确认包ACK（ack=y+1），客户端进入ESTABLISHED状态。服务端收到后也进入该状态[^3] 
2. 正式开始传输数据
3. 一方主动关闭连接
4. 四次挥手[^4][[挥手.png]] 
	1. 含义：断开一个TCP连接时，需要客户端和服务端总共发送4个包以确认连接的断开。
	2. 目的：确保关闭连接时*数据已经发送完毕* 
	3. 过程（假如是客户端先发起关闭请求）
		1. 客户端停止发送数据，进入*FIN_WAIT 1*状态
			1. FIN报文
			2. 序列号seq
		2. 服务端发送，进入<u>CLOSE_WAIT</u>状态。
			1. 同步标志位ACK
			2. 确认号（用于确认序列号）：客户端发送的序列号+1
			3. 新序列号（无用）
			4. 客户端收到，进入*FIN_WAIT 2*状态，等待服务端发送的连接释放报文
		3. 发送完数据，服务端准备断开时发送。进入<u>LAST_ACK</u>状态
			1. 完成标志位FIN
			2. 新序列号
			3. 确认标志位ACK=1
			4. 确认号是客户端发送的序列号+1
		4. 客户端收到结束报文，
			1. 确认标志位ACK
			2. 确认号是服务端序列号+1
			3. 序列号是客户端上次挥手+1
			4. 进入*TIME_WAIT*状态，等待计时器设置的时间后进入CLOSED状态。服务端收到后进入CLOSED
[一文彻底搞懂 TCP三次握手、四次挥手过程及原理 - 掘金](https://juejin.cn/post/6844904070000410631?searchId=20230714200722D438FEDF3B1C394C3850) 

[^1]: 同步标志位SYN=1，序号seq=x
[^2]: 同步标志位SYN=1，序号seq=y，确认标志位ACK=1，确认号ack=x+1
[^3]: 确认标志位ACK=1，确认号ack=y+1，序号seq=x+1
[^4]: 由于TCP连接是全双工的，因此，每个方向都必须要单独进行关闭，这一原则是当一方完成数据发送任务后，发送一个FIN来终止这一方向的连接，收到一个FIN只是意味着这一方向上没有数据流动了，即不会再收到数据了，但是在这个TCP连接上仍然能够发送数据，直到这一方向也发送了FIN。