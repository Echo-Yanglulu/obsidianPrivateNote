# 概述
![[Pasted image 20220825234720.png]]
跑在一个普通的操作系统上，每个应用都是Docker的一个容器，即一个**子进程**。看起来和普通的多进程应用差不多，没有什么性能损失的方面，所以被称为划时代的项目。
docker引擎同时创建多个子进程，每个子进程用于一个容器。

前提：分布式部署，需要有多个服务才有使用的必要。

Q: Docker是如何把这些==进程正确隔离==的？看底层技术
A: 依赖操作系统的机制：linux提供了namespaces 机制[^1]（*命名冲突问题*）与control group机制[^2]（*内存资源问题*）。
	1. 通过6种namespaces 。
		1. 用户与用户组的
		2. 文件系统挂载的
		3. 进程ID的
		4. 进程通信的
		5. 网络的
		6. 主机名和域名的
	2. control group机制
		1. 创建一个control group，指定参数：CPU占用，内存占用，磁盘占用，如此，被加入这个组中的进程就会受到这个限制。然后再创建一个容器加入这个control group。
Q: 每个容器相互独立，是否存在==重复资源==（文件系统之间可能大部分是一样的，占据磁盘空间）？（*硬盘资源问题*）
A: Docker的分层机制：分层也叫镜像，每层都是**不可修改的**。（用于在多个容器之间共享一些文件资源？一个镜像就是一个文件系统？）
	1. 如果需要修改：会**新建**一个分层，在新分层做修改。通过UnionFS机制把新旧分层**合并**，变成一个**文件系统**。多个容器进行了文件修改，只需新建多个分层，
## 定义
特点
	1. 释放计算虚拟化的威力
	2. 降低云计算应用开发成本
	3. 提高应用的维护效率
	4. 对系统资源利用率更高 
		1. 容器不需要进行硬件虚拟， 运行完整的操作系统
	5. 让应用的部署，测试，分发都更高效轻松
## 对比
作为一个虚拟化的方案，和虚拟机（同样做虚拟化）的区别是什么？
	1. 高效利用系统资源，相同配置的主机可运行更多应用
	2. 直接运行于宿主机的内核，不用启动完整的操作系统。不同于虚拟机的分钟，这个是秒级甚至毫秒级
	3. 一致的运行环境。
		1. 由于开发、测试、生产的运行环境不一致，导致一些BUG无法在开发过程中发现。提供了除内核外完整的运行环境，确保运行环境的一致，避免了代码在不同机器表现不同的问题。
		2. 轻松进行**应用迁移**
			1. Docker可在多平台运行（物理机，虚拟机，公有云，私有云，甚至笔记本：运行结果都一致），用户可轻松地把一个平台的应用迁移到另一个平台。不会导致环境变化导致应用无法启动
	4. 更轻松的维护与扩展
		1. 应用部分的复用更轻松。
		2. 基于基础镜像拓展镜像也变得简单
		3. 降低了应用服务的制做成本
	5. 可通过定制应用镜像来实现CI/CD
		1. 通过Dockerfile 进行镜像构建，并结合持续集成系统进行集成测试。
		2. 运维人员可在生产环境使用这些已经经过测试的镜像来快速部署。
# 基础知识
**容器**container
	1. 一种虚拟技术，是为用户隔离出来的，运行在主操作系统之上的==[[操作系统]]实例==，是带有虚拟化环境的程序（本质是**进程**）
		1. 提供了额外的**资源使用控制**，有安全优势，并且可以快速抢建和销毁。
	2. 可以在一个机器上跑多个容器。
**镜像**image
1. 构建好的环境，用来==创建容器==的可执行文件。
二者像类与对象、程序与进程的关系。
**宿主机**
DockerHub平台：共享自己打包好的镜像，类似Docker中的npm仓库
Dockerfile：一个文件，描述了该镜像是如何建立起来的。
# 底层技术
利用了（Linux）操作系统提供的能力，主要使用
	1. Linux Cgroups ：Linux内核的一种**限制进程所使用资源**的机制
	2. Linux Namespaces：Linux内核中一种对**内核资源进行分区**的机制。
		1. 可使每个进程都访问不同的资源。如两个进程可有各自的操作系统根目录。其实这多个根目录对于宿主机而言是两个目录
所以，最纯正的Docker只存在于Linux平台。想在生产环境使用Docker必须使用Linux。

# 使用

安装
![[Pasted image 20220825235438.png]]
# docker [[CLI]] 
使用docker pull jenkins命令**拉取镜像**到本地
docker run jenkins**启动容器**
docker attach进入容器（像进入了一个新的操作系统）
docker stop停止容器
```ad-summary
Docker的底层技术原理：资源限制，资源分区

```

# 案例
#### 使用Docker部署[[Verdaccio]]
task: 使用DockerHub上的官方镜像，一键部署Verdaccio
	1. 要部署一个开源项目，先在DockerHub 上找到这个项目的相关镜像。

[^1]: 可以给进程，用户，网络等分配一个命名空间，命名空间内的资源都是独立命名的。
[^2]: 避免一个容器占用较多资源，影响其他容器。需要一种机制限制容器的资源访问。操作系统本身也有这种机制，会限制node的占用内存，避免某个进程占用内存较大影响其他进程。