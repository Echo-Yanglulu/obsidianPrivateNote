目标
	1. 前端监控的核心问题/流程
		1. 异常捕获[^4]
		2. 数据上报[^5]
		3. 数据分析[^6]
		4. 告警[^7]

# 为何监控
后端：负载是否太高，性能是否正常。
前端：
	1. 异常监控[^1]
	2. 性能监控[^2]

1. 监控是软件质量最后的防线，发现==真实场景==中才会出现的==问题==[^3]
2. 发现问题后==反馈==一些实时并全面的数据。
# 如何监控
1. 异常捕获
	1. 浏览器
		1. 同步
			1. 全局异常：window.onerror[^8]
			2. js错误，资源加载错误：window.addEventListener('error')
		2. 异步
			1. 没有被catch的promise错误：window.addEventListener('unhandledrejection')
			2. 重写原生、软件包的相关方法：![[Pasted image 20220723112615.png]]
			3. 利用框架提供的API：![](https://i.imgur.com/rbQisTy.png)

2. 数据上报
	1. 方式简单：只需发送一个请求。
	2. 内容/关注内容
		1. 跨域：图像ping，JSONP，CORS
		2. 性能：Batch Sending[^9]
		3. 附带信息：上下文信息（用户信息，错误前后的console log）
3. 数据分析
4. 告警
# 业界监控方案
## 组成
### [[sentry]]
大部分自建的监控平台都不会比sentry优秀，网易云课堂也在用，可解决前端99%的监控需求
# 优化点
随着业务规模的扩大，sentry之类的开源方案可能无法满足
明白了这些开源方案，就可能魔改出自己的开源方案，甚至自己造轮子。
1. 前端监控的显著特点：短时间产生大量数据[^10]。
	1. 采集端
		1. 修改采样率[^11]
	2. 收集端
		1. 使用生产者-消费者模式：利用消息队列控制消息的消费速度
2. 效果增强
	1. 更多告警方式
	2. 收集用户反馈
	3. 更丰富的上下文信息：用户操作录像等（rrweb）







[^1]: 有lint，CR，测试，还有异常监控才能形成闭环。之前的都是开发场景
[^2]: 这个不用关注
[^3]: 生产环境上的脏数据，网络环境较差，浏览器缓存等原因导致的问题。
[^4]: 如何高效，准确，全面地捕获异常？
[^5]: 上报时间？性能与全面的取舍（只有错误可能信息不足，需要加上上下文）
[^6]: 能否根据上报信息得到深层的，有价值的结论。
[^7]: 实时地知道应用出错。何时，如何。
[^8]: 无法捕获跨域异常。不同浏览器可能堆栈信息不一致。无法捕获资源加载的异常
[^9]: 信息量过大时，可将一段时间内收集到的所有错误一直发送（减小频率，增大幅度），减小B与S的压力
[^10]: 成千上万个用户，如果每个用户一个报错，会有很多数据
[^11]: 修改为1/10，上报部分错误