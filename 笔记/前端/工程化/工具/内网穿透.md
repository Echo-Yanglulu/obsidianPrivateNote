# 概述
为何
	1. 领导访问不了内网，但想看你的页面。（本地服务只能在内网通过IP访问）特意找个测试环境部署太复杂，
定义：即NAT穿透（Network Address Translation：网络地址转换[^1]）

把本地服务快速地让公网访问。
	1. 测试，分享

原理：在公司、学校使用的都是局域网（内网），同一内网的机器IP不同，但访问公网时使用的是同一个对外IP，中间就用到了NAT机制。
优点
	1. 解决了IPV4地址紧缺的问题。
	2. 立刻生效，代码更新不用重复部署
	3. 不需要额外服务器（部署）。
	4. 不需要配置DNS，防火墙
缺点
	1. 机器处于同一个内外，所以当前机器无法被公网（外网）访问。因为公网只认内网对外的唯一IP，无法访问到一个内网中的某个IP。

内网穿透就是：穿透这种NAT转换机制。
原来：外网只能访问NAT提供的唯一IP
穿透：外网可访问NAT之前的每个内网中的IP。

为何？
	1. 获取本地资源
		1. 在公网访问部署在本地的服务
		2. 如：本地启了一个WEB服务，本地可使用localtunnel 访问，相同内网的机器也可使用内网IP访问，但公网无法访问。
# 工具
可在内网生成一个唯一的供外网访问的URL，这个URL会代理本地运行的WEB服务请求。（外网访问这个URL就是在访问一个代理服务器）
解决了想发布网站到外网，却没有公网IP。
## localtunnel 
为了轻松地测试与分享，向世界提供你的localhost。

### 原理
基于[[node]] 编写
### 安装与使用
快速启动：npx localtunnel --port 8000
安装启动：npm i -g localtunnel 
lt -port 8000

使用lt --help查看localtunnel的默认服务域名
本地已经启动locahost:3000时：lt -p 3000 -h https://tunnel.svrx.io -s happy。（端口，域名，子域名）

### API
默认开启LT：本地服务启动时就启动lt。
```javascript
const lt = require('localtunnel')
(async () => {
	const tunnel = await localtunnel({
		port: 3000,
		subdomain: 'happy'
	})
	tunnel.url;
	tunnel.on('close', () => {
		// 监听关闭事件
	})
})()
```
## ngrok
# 部署自己的内网穿透服务
原因：默认服务器在国外，使用默认地址访问很慢、不稳定
## 前提
自己用于部署lt服务的机器需要满足
	1. 支持DNF泛域名解析。（因为lt会向主域名发起请求，索要一个生成的子域名。使用它访问内网的服务。所以需要包括对主域名及子域名的所有的解析）
	2. 能监听任何非root权限的TCP端口。（lt服务端与客户端使用TCP连接）
## 过程
已经有一个注册的域名
1. 配置DNS解析
	1. 添加两个A类记录：把主域名和子域名都指向服务器的IP。等待DNS生效
2. 在服务器上安装好lt的server端并启动。在启动命令中指定服务运行的端口。
3. 默认域名是二级域名。如果自己的域名本身已经是三级域名，则启动服务时还需对--domain传三级域名
lt客户端默认使用的是localtunnel.me这个域名，所以启动时--host传参使用自己部署的域名与端口号即可。

# 在实际开发中的使用


[^1]: 在数据包通过路由器时重写IP地址。